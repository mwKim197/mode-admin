import{a as x,d as T,e as P}from"./main-sl8-cRuz.js";let w=null,p=null,I="",g="";function V(){A(),q(),L()}function q(){const i=document.querySelector(".btn-outline");i&&i.addEventListener("click",o=>{o.preventDefault(),F()})}let t=null;async function A(){try{const o=JSON.parse(localStorage.getItem("userInfo")||"{}").userId;if(!o)return;const e=await(await x(`/model_user_setting?func=get-user&userId=${o}`)).json();if(e&&e.user){t=e.user;const s=document.getElementById("storeNm");s&&(s.value=e.user.storeName||"");const r=document.querySelector("#tel-input");r&&(r.value=e.user.tel||"");const l=document.getElementById("businessNo");l&&(l.value=e.user.businessNo||"");const u=document.querySelector('.in-box input[type="text"]');u&&(u.value=e.user.limitCount||"");const d=document.querySelector("#wash-time-input");d&&(d.value=e.user.washTime||"");const m=document.querySelector("#remote-address");m&&(m.value=e.user.remoteAddress||"");const f=document.querySelectorAll('input[type="checkbox"]')[0];if(f&&(f.checked=!e.user.payType),e.user.logoUrl){const n=document.getElementById("logoPreview");n&&(n.src=e.user.logoUrl,n.style.display="block",n.onerror=()=>{n.style.display="none"})}else if(e.user.logoBase64){const n=document.getElementById("logoPreview");n&&(n.src=e.user.logoBase64,n.style.display="block")}if(e.user.iconUrl){const n=document.getElementById("iconPreview");n&&(n.src=e.user.iconUrl,n.style.display="block",n.onerror=()=>{n.style.display="none"})}else if(e.user.iconBase64){const n=document.getElementById("iconPreview");n&&(n.src=e.user.iconBase64,n.style.display="block")}}}catch{window.showToast("매장 정보 로드에 실패했습니다.",3e3,"error")}}async function F(){var i;try{const o=JSON.parse(localStorage.getItem("userInfo")||"{}");if(!localStorage.getItem("accessToken"))return;const e=o.userId||"zero001",s=document.querySelector('input[name="player-id"]'),r=document.querySelector("#tel-input"),l=document.querySelector("#remote-address"),u=document.querySelector('input[type="password"]'),d=document.querySelector('.in-box input[type="text"]'),m=document.querySelector("#wash-time-input"),f=document.querySelectorAll('input[type="checkbox"]')[0];let n=!1,h=!1,v=!1;if(s&&s.value!==(t==null?void 0:t.storeName)&&(n=!0),r&&r.value!==(t==null?void 0:t.tel)&&(n=!0),l&&l.value!==(t==null?void 0:t.remoteAddress)&&(n=!0),m&&m.value!==(t==null?void 0:t.washTime)&&(n=!0),f&&f.checked!==!(t!=null&&t.payType)&&(n=!0),u&&u.value!==""&&u.value!=="******"){if(u.value.length<6){window.showToast("비밀번호는 6자리 이상이어야 합니다.",3e3,"warning");return}h=!0}const y=(d==null?void 0:d.value)||"",B=((i=t==null?void 0:t.limitCount)==null?void 0:i.toString())||"";if(d&&y!==""&&y!==B&&(n=!0),(w||p)&&(v=!0),!n&&!h&&!v){window.showToast("변경사항이 없습니다.",3e3,"warning");return}if(n||v){const c={userId:e,adminId:e};s&&s.value!==(t==null?void 0:t.storeName)&&(c.storeName=s.value),r&&r.value!==(t==null?void 0:t.tel)&&(c.tel=r.value),l&&l.value!==(t==null?void 0:t.remoteAddress)&&(c.remoteAddress=l.value),m&&m.value!==(t==null?void 0:t.washTime)&&(c.washTime=m.value),f&&f.checked!==!(t!=null&&t.payType)&&(c.payType=!f.checked),d&&y!==""&&y!==B&&(c.limitCount=parseInt(y)),w&&(c.logoFileName=w.name,c.logoBase64=I),p&&(c.iconFileName=p.name,c.iconBase64=g);const S=await T("/model_user_setting?func=update-user",c),k=await S.json();(k.success||k.status==="success"||S.ok)&&await P("/model_machine_controll",{userId:e,func:"update-user"})}if(h){const c={userId:e,newPassword:u.value,adminId:e};await T("/model_user_setting?func=update-password",c)}window.showToast("변경사항이 저장되었습니다.",3e3,"success"),u&&(u.value="******"),w&&(w=null,I=""),p&&(p=null,g="")}catch{window.showToast("저장 중 오류가 발생했습니다.",3e3,"error")}}function L(){const i=document.getElementById("logoUpload");i&&i.addEventListener("change",z);const o=document.getElementById("iconUpload");o&&o.addEventListener("change",_)}function b(i,o,a){return new Promise(e=>{const s=new Image;s.onload=()=>{e(s.width<=o&&s.height<=a)},s.src=URL.createObjectURL(i)})}function E(i){return new Promise((o,a)=>{const e=new FileReader;e.onload=()=>{const r=e.result.split(",")[1];o(r)},e.onerror=a,e.readAsDataURL(i)})}function N(i){return new Promise((o,a)=>{const e=new FileReader;e.onload=()=>o(e.result),e.onerror=a,e.readAsDataURL(i)})}async function z(i){var r;const o=(r=i.target.files)==null?void 0:r[0];if(!o)return;if(o.size>2*1024*1024){window.showToast("파일 크기는 2MB 이하여야 합니다.",3e3,"warning");return}if(!await b(o,600,140)){window.showToast("로고 이미지는 600x140 이하여야 합니다.",3e3,"warning");return}w=o,I=await E(o);const e=document.getElementById("fileName");e&&(e.textContent=o.name);const s=document.getElementById("logoPreview");if(s){const l=await N(o);s.src=l,s.style.display="block"}}async function _(i){var r;const o=(r=i.target.files)==null?void 0:r[0];if(!o)return;if(o.size>2*1024*1024){window.showToast("파일 크기는 2MB 이하여야 합니다.",3e3,"warning");return}if(!await b(o,1300,2e3)){window.showToast("아이콘 이미지는 1300x2000 이하여야 합니다.",3e3,"warning");return}p=o,g=await E(o);const e=document.getElementById("iconFileName");e&&(e.textContent=o.name);const s=document.getElementById("iconPreview");if(s){const l=await N(o);s.src=l,s.style.display="block"}}export{V as initNormalSet};
