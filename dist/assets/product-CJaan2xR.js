import{g as y,a as D,e as v}from"./main-wanxikgH.js";const d=[];let l=[],h=null;function M(){const e=y();if(!e){window.showToast("❌ 사용자 정보가 없습니다.",3e3,"error");return}c();async function o(){return(await(await D(`/model_admin_menu?userId=${e==null?void 0:e.userId}&func=get-all-menu`)).json()).items}async function t(){try{const n=await o();l=n,f(n),d.length=0}catch(n){console.error("❌ 메뉴 목록 불러오기 실패",n)}}function c(){const n=document.getElementById("searchProduct"),s=document.getElementById("searchButton"),i=document.getElementById("searchReset");s&&s.addEventListener("click",function(){const r=(n==null?void 0:n.value.trim())||"";I(r)}),i&&i.addEventListener("click",function(){n&&(n.value=""),f(l)}),n&&(n.addEventListener("keypress",function(r){if(r.key==="Enter"){const g=n.value.trim();I(g)}}),n.addEventListener("input",function(){const r=n.value.trim();h&&clearTimeout(h),h=setTimeout(()=>{p(r)},300)}))}function p(n){let s;n.length>0?s=l.filter(i=>{var r;return(r=i.name)==null?void 0:r.toLowerCase().includes(n.toLowerCase())}):s=l,f(s)}function I(n){let s;n.length>0?s=l.filter(i=>{var r;return(r=i.name)==null?void 0:r.toLowerCase().includes(n.toLowerCase())}):s=l,f(s),s.length===0&&n.length>0&&window.showToast(`"${n}"에 대한 검색 결과가 없습니다.`,3e3,"warning")}function f(n){const s=document.getElementById("menu-table-body");s&&(s.innerHTML=n.map(i=>{var k;const r=((k=i.image)==null?void 0:k.split("\\").pop())??"",g=encodeURIComponent(r),B=`https://model-narrow-road.s3.ap-northeast-2.amazonaws.com/model/${i.userId}/${g}`;return`
      <tr>
        <td >${i.no}</td>
        <td style="text-align: center;"><img src="${B}" alt="상품 이미지" style="width:36px;height:46px; object-fit:cover;display: inline-block;"></td>
        <td class="product-name" onclick="window.location.href='./product-detail.html?menuId=${i.menuId}'">
          ${i.name}
        </td>
        <td>${Number(i.price).toLocaleString()}</td>
        <td>
          <label class="toggle-switch">
            <input
              type="checkbox"
              ${i.empty==="no"?"checked":""}
              onchange="onToggleChange(${i.menuId}, this.checked)">
            <span class="slider"></span>
          </label>
        </td>
        <td>
          ${i.cupYn==="yes"?'<span class="tag gray disabled">제조</span>':`<span class="tag blue" data-menu='${encodeURIComponent(JSON.stringify(i))}' onclick="onAdminOder(this)">제조</span>`}
          <span class="tag red" onclick="onDeleteClick(${i.menuId}, event)">삭제</span>
        </td>
      </tr>
    `}).join(""))}t()}const T=document.getElementById("saveBtn");T&&T.addEventListener("click",()=>{if(d.length===0){window.showToast("변경된 내용이 없습니다.",3e3,"warning");return}confirm("수정사항을 저장하시겠습니까?")&&x().catch(()=>{window.showToast("❌ 수정에 실패했습니다.",3e3,"error")})});function P(e,o){C(e,{empty:o?"no":"yes"})}function O(e,o){C(e,{delete:!0});const t=o.target.closest("tr");t&&t.classList.add("tr-disabled")}function A(e){return{orderData:{orderList:[{orderId:`${e.menuId}-${e.userId}`,userId:e.userId,menuId:e.menuId,name:e.name,count:1}]}}}function C(e,o){const t=d.findIndex(c=>c.menuId===e);t!==-1?d[t]={...d[t],...o}:d.push({menuId:e,...o})}async function x(){const e=y();if(!e)return;const o={userId:e.userId,items:d};try{const t=await v("/model_admin_menu?func=bulk-update-or-delete",o);if(t.ok)window.showToast("변경 사항 저장 완료"),location.reload();else{const c=await t.json();console.error("❌ 저장 실패:",c.message),window.showToast(`❌ 저장 실패: ${c.message} `,3e3,"error")}}catch(t){console.error("❌ 저장 오류:",t),window.showToast(`❌ 저장 오류: ${t} `,3e3,"error")}}async function m(e,o={}){const t=y();if(!t){window.showToast("❌ 사용자 정보가 없습니다.",3e3,"error");return}const c={func:e,userId:t.userId,...e==="order"?{orderData:o.orderData}:{},...e==="drink"?{orderData:{recipe:o}}:{},...e==="ice"?{orderData:{recipe:{iceTime:o.iceTime,waterTime:o.waterTime,name:o.name}}}:{}};v("/model_machine_controll",c).then(()=>{window.showToast(`${e} 명령 전송 완료`)}).catch(p=>{console.error(`❌ ${e} 명령 전송 실패:`,p),window.showToast(`❌ ${e} 명령 전송 실패: ${p} `,3e3,"error")}),window.showToast(`${e} 명령 전송`)}window.onToggleChange=P;window.onDeleteClick=O;window.onAdminOder=S;let a=null;function S(e){const o=decodeURIComponent(e.dataset.menu||"{}");a=JSON.parse(o);const c=document.getElementById("adminActionPopup");c&&(c.style.display="block")}function u(){const e=document.getElementById("adminActionPopup");e&&(e.style.display="none")}const b=document.getElementById("btnPopupTotalOrder");b&&b.addEventListener("click",()=>{if(a){if(!confirm("원격 명령을 전송하시겠습니까?"))return;const e=A(a);m("order",e),u()}});const E=document.getElementById("btnCupDispense");E&&E.addEventListener("click",()=>{if(a){const e=a.cup;e==="plastic"?confirm("원격 명령을 전송하시겠습니까?")&&(m("pl"),u()):e==="paper"&&confirm("원격 명령을 전송하시겠습니까?")&&(m("pa"),u())}});const $=document.getElementById("btnIceWaterDispense");$&&$.addEventListener("click",()=>{a&&confirm("원격 명령을 전송하시겠습니까?")&&(m("ice",a),u())});const L=document.getElementById("btnPopupDrinkOrder");L&&L.addEventListener("click",()=>{confirm("원격 명령을 전송하시겠습니까?")&&a&&(m("drink",a),u())});const w=document.getElementById("adminActionPopup");w&&w.addEventListener("click",e=>{e.target===w&&(w.style.display="none")});window.closeAdminPopup=u;export{M as initProduct};
