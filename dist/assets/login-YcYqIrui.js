import{s as h}from"./main-Bqfk0G7A.js";const d="https://api.narrowroad-model.com";function k(){console.log("âœ… login.ts ë¡œë“œë¨"),localStorage.removeItem("accessToken"),localStorage.removeItem("userInfo");const n=document.getElementById("login-form");if(!n){console.error("âŒ ë¡œê·¸ì¸ í¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ");return}n.addEventListener("submit",async e=>{e.preventDefault(),localStorage.removeItem("accessToken"),localStorage.removeItem("userInfo"),console.log("ğŸ—‘ï¸ ê¸°ì¡´ ë¡œê·¸ì¸ í† í° ì‚­ì œë¨");const r=document.getElementById("adminId").value.trim(),o=document.getElementById("password").value.trim(),t=document.getElementById("agree").checked;if(!r||!o){alert("ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");return}window.showLoading();try{const s=await fetch(`${d}/model_admin_login?func=login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({adminId:r,password:o})}),c=await s.json();s.ok?await g(c,t):alert(c.message||"ë¡œê·¸ì¸ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.")}catch(s){console.error("âŒ ë¡œê·¸ì¸ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:",s),alert("ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.")}finally{window.hideLoading()}});const a=document.getElementById("kakao-login-btn");a&&a.addEventListener("click",u)}function u(){const e="https://kauth.kakao.com/oauth/authorize?response_type=code&client_id=240886095629b93f9655026145a39487&redirect_uri=https://zeroadmin.kr/html/kakao-callback.html",r=window.matchMedia("(max-width: 768px)").matches,o=document.getElementById("agree").checked;if(r)console.log("ğŸ“± ëª¨ë°”ì¼ í™˜ê²½ â†’ ë¦¬ë””ë ‰íŠ¸ ë°©ì‹"),window.location.href=e;else{console.log("ğŸ’» PC í™˜ê²½ â†’ íŒì—… ë¡œê·¸ì¸ ì‚¬ìš©");const t=window.open(e,"kakaoLogin","width=500,height=700"),s=async c=>{if(c.origin!=="https://zeroadmin.kr")return;const{code:m}=c.data;if(!m){console.error("âŒ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì½”ë“œ ì—†ìŒ"),alert("ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.");return}window.removeEventListener("message",s),t==null||t.close(),console.log("âœ… ì¹´ì¹´ì˜¤ code ìˆ˜ì‹ :",m);try{const i=await fetch(`${d}/model_admin_login?func=kakao-login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:m})}),l=await i.json();i.ok&&l.accessToken?(console.log("âœ… ê¸°ì¡´ ì‚¬ìš©ì ë¡œê·¸ì¸ ì„±ê³µ"),await g(l,o)):i.ok&&l.redirectUrl?(console.log("ğŸ†• ì‹ ê·œ ì‚¬ìš©ì â†’ ì—°ë™ í˜ì´ì§€ ì´ë™"),window.location.href=l.redirectUrl):(console.error("âŒ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì‹¤íŒ¨ ì‘ë‹µ:",l),alert("ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”."))}catch(i){console.error("âŒ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ìš”ì²­ ì˜¤ë¥˜:",i),alert("ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.")}};window.addEventListener("message",s,{once:!0})}}async function g(n,a=!1){try{localStorage.setItem("accessToken",n.accessToken),a?(console.log("âœ… ë¡œê·¸ì¸ ì„±ê³µ â†’ ìë™ë¡œê·¸ì¸ í™œì„±í™”"),localStorage.setItem("refreshToken",n.refreshToken)):(console.log("âœ… ë¡œê·¸ì¸ ì„±ê³µ â†’ ìë™ë¡œê·¸ì¸ ì‚­ì œ"),localStorage.removeItem("refreshToken")),console.log("âœ… ë¡œê·¸ì¸ ì„±ê³µ â†’ í† í° ì €ì¥ ì™„ë£Œ!");const e=await fetch(`${d}/model_admin_login?func=me`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.accessToken}`},mode:"cors"});if(!e.ok){console.error("âŒ ì‚¬ìš©ì ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:",e.status),alert("ìœ ì € ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");return}const r=await e.json();if(r.userId){const o=await fetch(`${d}/model_user_setting?func=get-user&userId=${r.userId}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.accessToken}`},mode:"cors"});if(o.ok){const{user:t}=await o.json();h(t),console.log("âœ… ì‚¬ìš©ì ì •ë³´ ì €ì¥ ì™„ë£Œ")}else{const t=await o.text();console.error("âŒ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:",o.status,t),alert("ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");return}}window.location.href="/html/home.html"}catch(e){console.error("âŒ postLogin ì²˜ë¦¬ ì˜¤ë¥˜:",e),alert("ë¡œê·¸ì¸ í›„ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}}export{k as initLogin};
