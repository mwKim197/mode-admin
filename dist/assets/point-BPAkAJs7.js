var K=Object.defineProperty;var H=(t,e,o)=>e in t?K(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var h=(t,e,o)=>H(t,typeof e!="symbol"?e+"":e,o);import{a as L,b as C,c as q,d as O}from"./apiHelpers-6xWUHFcW.js";import{g as v,a as j}from"./main-LfBHUVYu.js";class J{constructor(e){h(this,"data");h(this,"pageSize");h(this,"blockSize");h(this,"container");h(this,"onPageChange");h(this,"currentPage");this.data=e.data,this.pageSize=e.pageSize||10,this.blockSize=e.blockSize||5,this.container=document.getElementById(e.containerId),this.onPageChange=e.onPageChange,this.currentPage=1,this.render(),this.movePage(1)}get totalPages(){return Math.ceil(this.data.length/this.pageSize)}render(){this.container.innerHTML="";const e=document.createElement("button");e.textContent="<",e.onclick=()=>this.moveBlock(-1),this.container.appendChild(e);for(let n=1;n<=this.totalPages;n++){const a=document.createElement("button");a.textContent=String(n),a.dataset.page=String(n),a.onclick=()=>this.movePage(n),this.container.appendChild(a)}const o=document.createElement("button");o.textContent=">",o.onclick=()=>this.moveBlock(1),this.container.appendChild(o),this.updateVisibleButtons()}movePage(e){if(e<1||e>this.totalPages)return;this.currentPage=e;const o=(e-1)*this.pageSize,n=o+this.pageSize,a=this.data.slice(o,n);this.onPageChange(a,e),this.updateActiveButton(),this.updateVisibleButtons()}moveBlock(e){const a=(Math.floor((this.currentPage-1)/this.blockSize)+e)*this.blockSize+1;a<1||a>this.totalPages||this.movePage(a)}updateActiveButton(){this.container.querySelectorAll("button").forEach(o=>{o.dataset.page&&o.classList.toggle("active",Number(o.dataset.page)===this.currentPage)})}updateVisibleButtons(){const e=this.container.querySelectorAll("button"),o=Math.floor((this.currentPage-1)/this.blockSize);e.forEach(n=>{if(!n.dataset.page)return;const a=Number(n.dataset.page),c=o*this.blockSize+1,m=c+this.blockSize-1;a>=c&&a<=m?n.style.display="inline-block":n.style.display="none"})}}function R({data:t,currentPage:e,limit:o,onPageChange:n,containerId:a}){const c=Math.ceil(t.total/o),m=t.pageKeys?JSON.parse(t.pageKeys):[],u=document.getElementById(a);if(!u)return;u.innerHTML="";const d=5;let p=Math.max(1,e-Math.floor(d/2)),s=p+d-1;s>c&&(s=c,p=Math.max(1,s-d+1));const r=document.createElement("button");r.innerHTML="&lt;",r.disabled=e===1,r.addEventListener("click",()=>{e>1&&n(e-1===1?null:m[e-3]||null,e-1)}),u.appendChild(r);for(let i=p;i<=s;i++){const g=document.createElement("button");g.setAttribute("data-page",String(i)),g.innerText=String(i),g.style.display="inline-block",i===e&&g.classList.add("active"),g.addEventListener("click",()=>{const f=i===1?null:m[i-2]||null;n(f,i)}),u.appendChild(g)}const l=document.createElement("button");l.innerHTML="&gt;",l.disabled=e===c,l.addEventListener("click",()=>{e<c&&n(m[e-1]||null,e+1)}),u.appendChild(l)}async function U(t){const e=await L(`/model_user_setting?func=get-user&userId=${t}`);if(!e.ok){const n=await e.json();return console.error("üî¥ ÏùëÎãµ Î≥∏Î¨∏:",n),alert("‚ùå ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§."),null}const{user:o}=await e.json();return console.log("‚úÖ ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥:",o),o}let E=!1,k=[],y,V=1;const P=10;let b={},S=!1;async function ee(){const t=v();if(!t){alert("ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.");return}Q((t==null?void 0:t.isPhone)??!0);const e=document.getElementById("popupTel");e&&_(e),document.getElementById("earnMileage").value=String(t.earnMileage??""),document.getElementById("mileageNumber").value=String(t.mileageNumber??""),document.getElementById("isPhone").checked=t.isPhone??!1;const o=document.getElementById("isPhone"),n=document.getElementById("mileageNumber");o&&n&&(o.addEventListener("change",()=>{o.checked?(n.value="11",n.disabled=!0,n.placeholder="Ìú¥ÎåÄÌè∞Î≤àÌò∏ 11ÏûêÎ¶¨ Í≥†Ï†ï"):(n.disabled=!1,n.value="",n.placeholder="4-12")}),o.checked&&(n.value="11",n.disabled=!0,n.placeholder="Ìú¥ÎåÄÌè∞Î≤àÌò∏ 11ÏûêÎ¶¨ Í≥†Ï†ï"));const a=document.getElementById("selectAllBtn");if(!a)return;a.addEventListener("click",function(){E=!E,document.querySelectorAll("input.row-checkbox").forEach(g=>{g.checked=E}),a.className=E?"btn-s mb10":"btn-s blue mb10",a.textContent=E?"Ï†ÑÏ≤¥Ìï¥Ï†ú":"Ï†ÑÏ≤¥ÏÑ†ÌÉù",console.log(`ÌòÑÏû¨ ÏÑ†ÌÉùÎêú Ìï≠Î™© Ïàò: ${document.querySelectorAll("input.row-checkbox:checked").length}`)}),document.getElementById("pointInfoSave").addEventListener("click",async function(){await F()});const m=document.getElementById("searchNumber"),u=document.getElementById("searchButton"),d=document.getElementById("searchReset");u.addEventListener("click",()=>{const i=m.value.trim();if(!i){alert("Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");return}const g=k.filter(f=>{var B,I;return((B=f.mileageNo)==null?void 0:B.includes(i))||((I=f.tel)==null?void 0:I.includes(i))});M(g)}),d.addEventListener("click",()=>{m.value="",M(k)}),document.querySelectorAll(".popupCloseBtn").forEach(i=>{i.addEventListener("click",()=>{z()})}),document.getElementById("saveButton").addEventListener("click",async()=>{S?await x("update"):await x("create")}),document.getElementById("createPointBtn").addEventListener("click",()=>{y=void 0,S=!1,T()});const l=document.getElementById("deleteButton");l&&l.addEventListener("click",async()=>{const i=document.querySelectorAll("input.row-checkbox:checked");if(i.length===0){alert("ÏÇ≠Ï†úÌï† Ìï≠Î™©ÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.");return}if(!confirm(`ÏÑ†ÌÉùÌïú ${i.length}Í∞ú Ìï≠Î™©ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`))return;const f=v();if(!f){alert("ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.");return}const B=f.userId;let I=0;for(const D of i){const $=D.dataset.id;if(!$)continue;(await C(`/model_admin_mileage?func=mileage-delete&userId=${B}&uniqueMileageNo=${$}`)).ok||(I++,console.error(`‚ùå ÏÇ≠Ï†ú Ïã§Ìå®: ${$}`))}I>0?alert(`‚ùå ${I}Í±¥ ÏÇ≠Ï†ú Ïã§Ìå®`):alert("‚úÖ ÏÑ†ÌÉùÎêú ÎßàÏùºÎ¶¨ÏßÄÎ•º Î™®Îëê ÏÇ≠Ï†úÌñàÏäµÎãàÎã§."),await w()}),w()}function T(){const t=document.querySelector(".popup-overlay");t.style.display="flex";const e=document.getElementById("saveButton");e.textContent=S?"ÏàòÏ†ï":"Ï†ÄÏû•",document.getElementById("mileageNo").value="",document.getElementById("popupTel").value="",document.getElementById("popupPassword").value="",document.getElementById("popupMileage").value="",document.getElementById("popupCount").value="",document.getElementById("popupAmount").value="",document.getElementById("myTextarea").value=""}function z(){const t=document.querySelector(".popup-overlay");t.style.display="none"}async function F(){const t=v();if(!t){alert("ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.");return}const e=await j(),o=e==null?void 0:e.adminId,n=parseInt(document.getElementById("earnMileage").value,10),a=parseInt(document.getElementById("mileageNumber").value,10),c=document.getElementById("isPhone");if(!n){alert("ÎßàÏùºÎ¶¨ÏßÄ Ï†ÅÎ¶ΩÎ•†ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");return}if(!a){alert("ÎßàÏùºÎ¶¨ÏßÄ Ï†ÅÎ¶Ω Î≤àÌò∏ ÏûêÎ¶¨ÏàòÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");return}const m={userId:t.userId,adminId:o,isPhone:c.checked,earnMileage:n,mileageNumber:a};if(!(await q("/model_user_setting?func=update-user",m)).ok){console.error("‚ùå Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞ Ïã§Ìå®");return}const d=await U(t.userId);d&&(localStorage.setItem("userInfo",JSON.stringify(d)),alert("‚úÖ ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Ï†ÄÏû• ÏôÑÎ£å"))}async function w(){const t=v();if(!t){alert("ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.");return}const e=t.userId,o=await L(`/model_admin_mileage?userId=${e}&func=mileage&limit=1000`);if(!o.ok){console.error("‚ùå Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞ Ïã§Ìå®");return}k=(await o.json()).items||[],await M(k)}async function M(t){new J({data:t,pageSize:10,blockSize:5,containerId:"pagination",onPageChange:(e,o)=>{const n=document.querySelector("tbody"),a=document.getElementById("selectAllBtn");!n||!a||(E=!1,a.textContent="Ï†ÑÏ≤¥ÏÑ†ÌÉù",n.innerHTML="",e.forEach((c,m)=>{const u=document.createElement("tr"),d=c.amount??0;u.innerHTML=`
                  <td><input type="checkbox" class="row-checkbox" data-id="${c.uniqueMileageNo}"></td>
                  <td>${m+1+(o-1)*10}</td>
                  <td>${N(c.mileageNo)}</td>
                  <td>${Number(d).toLocaleString()}Ïõê</td>
                  <td><button class="btn-delete" data-id="${c.uniqueMileageNo}">ÏÇ≠Ï†ú</button></td>
                `,u.addEventListener("click",async s=>{const r=s.target;if(r.closest("input[type='checkbox']")||r.closest(".btn-delete"))return;const l=c;y=l,S=!0,T(),await A(y,V),document.getElementById("mileageNo").value=N(l.mileageNo??""),document.getElementById("popupTel").value=N(l.tel??""),document.getElementById("popupPassword").value=l.password??"",document.getElementById("popupMileage").value=String(Number(d).toLocaleString()??"0")+" Ïõê",document.getElementById("popupCount").value="",document.getElementById("myTextarea").value=l.note??""});const p=u.querySelector(".btn-delete");p.onclick=async()=>{if(!confirm("Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?"))return;const r=v();if(!r){alert("ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.");return}const l=r.userId;if(!(await C(`/model_admin_mileage?userId=${l}&func=mileage-delete&uniqueMileageNo=${c.uniqueMileageNo}`)).ok){alert("‚ùå ÏÇ≠Ï†ú Ïã§Ìå®");return}alert("‚úÖ ÏÇ≠Ï†ú ÏôÑÎ£å"),await w()},n.appendChild(u)}))}})}async function x(t){try{const e=document.getElementById("mileageNo").value.trim(),o=document.getElementById("popupTel").value.trim(),n=document.getElementById("popupPassword").value.trim(),a=document.getElementById("popupAmount").value.trim(),c=document.getElementById("myTextarea").value.trim(),m=v();if(!m){alert("ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.");return}const{userId:u,isPhone:d,mileageNumber:p}=m;if(!u||d===void 0||p===void 0){alert(`üìå Í≥†Í∞ùÎ≤àÌò∏ ÏÑ§Ï†ïÏù¥ ÎàÑÎùΩÎêòÏóàÏäµÎãàÎã§.
[Ìú¥ÎåÄÌè∞ Ïó¨Î∂Ä / ÏûêÎ¶øÏàò] Ï†ïÎ≥¥Î•º Î®ºÏ†Ä Îì±Î°ùÌï¥Ï£ºÏÑ∏Ïöî.`);return}const s=G(e,d,p);if(s){alert(s);return}const r=d?e.replace(/-/g,""):e;if(t==="create"){if(!o||!n||!a){alert("ÌïÑÏàò Ìï≠Î™©ÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");return}}else if(!o||!n){alert("ÌïÑÏàò Ìï≠Î™©ÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");return}if(!/^\d+$/.test(n)){alert("ÎπÑÎ∞ÄÎ≤àÌò∏Îäî Ïà´ÏûêÎßå ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");return}if(a&&!/^\d+$/.test(a)){alert("Ìè¨Ïù∏Ìä∏Îäî Ïà´ÏûêÎßå ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");return}const l={userId:u,mileageNo:r,password:n,points:a,tel:o};if(c&&(l.note=c),t==="update"){if(!(y!=null&&y.uniqueMileageNo)){alert("ÏÑ†ÌÉùÎêú Ìï≠Î™©Ïù¥ ÏóÜÏäµÎãàÎã§.");return}l.uniqueMileageNo=y.uniqueMileageNo,l.newPassword=n,delete l.password}const i=t==="create"?`/model_admin_mileage?userId=${u}&func=mileage-add`:"/model_admin_mileage?func=mileage-update",g=t==="create"?await O(i,l):await q(i,l);if(!g.ok){try{const f=await g.json(),B=(f==null?void 0:f.message)??`${t==="create"?"Îì±Î°ù":"ÏàòÏ†ï"} Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.`;alert(`‚ùå ${B}`)}catch{alert(`‚ùå ${t==="create"?"Îì±Î°ù":"ÏàòÏ†ï"} Ïã§Ìå®`)}return}alert(`‚úÖ ${t==="create"?"Îì±Î°ù":"ÏàòÏ†ï"} ÏôÑÎ£å`),z(),await w()}catch(e){console.error(`‚ùå ${t} Ïò§Î•ò:`,e),alert(`ÏÑúÎ≤Ñ Ïò§Î•òÎ°ú ${t==="create"?"Îì±Î°ù":"ÏàòÏ†ï"}Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.`)}}async function A(t,e=1){const o=v();if(!o)return;const n=b[e-1];let a=`/model_admin_mileage?func=mileage-history&userId=${o.userId}&uniqueMileageNo=${t.uniqueMileageNo}&limit=${P}`;n&&(a+=`&lastEvaluatedKey=${encodeURIComponent(JSON.stringify(n))}`);const c=await L(a),{items:m,total:u,pageKeys:d}=await c.json();if(b={},d)try{JSON.parse(d).forEach((r,l)=>{b[l+1]=r})}catch(s){console.warn("‚ö†Ô∏è pageKeys ÌååÏã± Ïã§Ìå®:",s)}const p=document.getElementById("historyTableBody");p&&(p.innerHTML="",m.forEach((s,r)=>{const l=document.createElement("tr"),i=new Date(s.timestamp);l.innerHTML=`
            <td>${r+1+(e-1)*P}</td>
            <td>${i.toLocaleDateString()}</td>
            <td>${i.toLocaleTimeString()}</td>
            <td>${Number(s.totalAmt??0).toLocaleString()}Ïõê</td>
            <td>${s.points}p</td>
            <td>${Number(s.amount).toLocaleString()}p</td>
        `,p.appendChild(l)}),R({data:{total:u,pageKeys:d},currentPage:e,limit:P,containerId:"historyPagination",onPageChange:(s,r)=>{b[r-1]=s,A(t,r)}}))}function G(t,e,o){const n=t.trim(),a=e?n.replace(/-/g,""):n;return/^\d+$/.test(a)?a.length!==o?`Ìè¨Ïù∏Ìä∏ Î≤àÌò∏Îäî ${o}ÏûêÎ¶¨Ïó¨Ïïº Ìï©ÎãàÎã§.`:null:"Ìè¨Ïù∏Ìä∏ Î≤àÌò∏Îäî Ïà´ÏûêÎßå ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî."}function Q(t){const e=document.getElementById("mileageNo");e&&(e.value="",e.placeholder=t?"010-1234-5678":"Ïà´ÏûêÎßå ÏûÖÎ†•",e.addEventListener("input",o=>{let n=o.target.value.replace(/\D/g,"");t?_(e):e.value=n}))}function _(t){t.addEventListener("input",()=>{const e=t.value.replace(/\D/g,"").slice(0,11);e.length<=3?t.value=e:e.length<=7?t.value=`${e.slice(0,3)}-${e.slice(3)}`:t.value=`${e.slice(0,3)}-${e.slice(3,7)}-${e.slice(7)}`})}function N(t){const e=t.replace(/\D/g,"");return e.length===11?`${e.slice(0,3)}-${e.slice(3,7)}-${e.slice(7)}`:e}export{_ as applyPhoneInputFormat,ee as initPoint};
