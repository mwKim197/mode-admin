const l="https://api.narrowroad-model.com";function g(){console.log("✅ login.ts 로드됨");const i=document.getElementById("login-form");if(!i){console.error("❌ 로그인 폼을 찾을 수 없음");return}i.addEventListener("submit",async a=>{a.preventDefault(),localStorage.removeItem("authToken"),localStorage.removeItem("userInfo"),console.log("🗑️ 기존 로그인 토큰 삭제됨");const r=document.getElementById("adminId").value.trim(),t=document.getElementById("password").value.trim();if(!r||!t){alert("아이디와 비밀번호를 입력해주세요.");return}try{console.log("🚀 로그인 요청 시작:",{adminId:r,password:t});const o=await fetch(`${l}/model_admin_login?func=login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({adminId:r,password:t}),mode:"cors"}),n=await o.json();if(console.log("📥 로그인 응답:",o.status,n),o.ok){localStorage.setItem("authToken",n.token),console.log("✅ 로그인 성공 → 토큰 저장 완료!");const e=await fetch(`${l}/model_admin_login?func=me`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},mode:"cors"});if(!e.ok){alert("유저 정보를 불러오지 못했습니다.");return}const m=await e.json();if(m.grade===4){const s=await fetch(`${l}/model_user_setting?func=get-user&userId=${m.userId}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},mode:"cors"});if(s.ok){const{user:d}=await s.json();localStorage.setItem("userInfo",JSON.stringify(d)),console.log("✅ 사용자 정보 저장 완료")}else{const d=await s.text();console.error("❌ 사용자 정보 조회 실패:",s.status,d),alert("사용자 정보를 불러오지 못했습니다.");return}}window.location.href="../../../html/dashboard.html"}else alert(n.message||"로그인 실패. 다시 시도하세요.")}catch(o){console.error("❌ 로그인 요청 중 오류 발생:",o),alert("서버 오류가 발생했습니다. 다시 시도하세요.")}});const c=document.getElementById("kakao-login-btn");c&&c.addEventListener("click",h)}function h(){const a="https://kauth.kakao.com/oauth/authorize?response_type=code&client_id=240886095629b93f9655026145a39487&redirect_uri=http://model-web-admin.s3-website.ap-northeast-2.amazonaws.com/html/kakao-callback.html";if(window.matchMedia("(max-width: 768px)").matches)console.log("📱 모바일 환경 → 리디렉트 방식"),window.location.href=a;else{console.log("💻 PC 환경 → 팝업 로그인 사용");const t=window.open(a,"kakaoLogin","width=500,height=700");window.addEventListener("message",o=>{if(o.origin!=="http://model-web-admin.s3-website.ap-northeast-2.amazonaws.com")return;const{code:n}=o.data;n&&(console.log("✅ 카카오 로그인 코드 받음:",n),t==null||t.close(),fetch(`${l}/model_admin_login?func=kakao-login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:n})}).then(e=>e.json()).then(e=>{e.token?(localStorage.removeItem("authToken"),console.log("🗑️ 기존 로그인 토큰 삭제됨"),localStorage.setItem("authToken",e.token),console.log("✅ 로그인 성공 → 토큰 저장 완료!"),window.location.href="../../../html/dashboard.html"):e.redirectUrl?(console.log("✅ 신규 사용자 → 연동 페이지로 이동:",e.redirectUrl),window.location.href=e.redirectUrl):alert("카카오 로그인 실패. 다시 시도하세요.")}).catch(e=>{console.error("❌ 로그인 오류:",e)}))})}}export{g as initLogin};
