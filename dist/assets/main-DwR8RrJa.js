const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./productDetail-SxdPi9-K.js","./imageUploader-BKZxeuqP.js","./productAdd-vxFGRBeC.js","./notice-D7rP3lcY.js","./notice-vODWoD1S.css"])))=>i.map(i=>d[i]);
(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const e of o)if(e.type==="childList")for(const a of e.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function r(o){const e={};return o.integrity&&(e.integrity=o.integrity),o.referrerPolicy&&(e.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?e.credentials="include":o.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function l(o){if(o.ep)return;o.ep=!0;const e=r(o);fetch(o.href,e)}})();const L="modulepreload",T=function(t,n){return new URL(t,n).href},_={},c=function(n,r,l){let o=Promise.resolve();if(r&&r.length>0){let a=function(i){return Promise.all(i.map(u=>Promise.resolve(u).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};const s=document.getElementsByTagName("link"),d=document.querySelector("meta[property=csp-nonce]"),f=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));o=a(r.map(i=>{if(i=T(i,l),i in _)return;_[i]=!0;const u=i.endsWith(".css"),p=u?'[rel="stylesheet"]':"";if(!!l)for(let g=s.length-1;g>=0;g--){const y=s[g];if(y.href===i&&(!u||y.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${p}`))return;const m=document.createElement("link");if(m.rel=u?"stylesheet":L,u||(m.as="script"),m.crossOrigin="",m.href=i,f&&m.setAttribute("nonce",f),document.head.appendChild(m),u)return new Promise((g,y)=>{m.addEventListener("load",g),m.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${i}`)))})}))}function e(a){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=a,window.dispatchEvent(s),!s.defaultPrevented)throw a}return o.then(a=>{for(const s of a||[])s.status==="rejected"&&e(s.reason);return n().catch(e)})},P="https://api.narrowroad-model.com";async function h(t,n={},r=!0){if(window.location.pathname.includes("/html/log.html")||window.location.pathname==="/")return{ok:!1,status:200,json:async()=>({message:"로그인 페이지에서는 인증 요청을 하지 않습니다."})};const o=localStorage.getItem("accessToken");if(!o)return console.log("❌ 토큰이 없습니다. 로그인 페이지로 이동합니다."),window.location.href="/html/log.html",{ok:!1,status:401,json:async()=>({message:"인증 토큰이 없습니다."})};const e={...n,headers:{...n.headers,Authorization:`Bearer ${o}`,"Content-Type":"application/json"}};r&&window.showLoading();try{const a=await fetch(`${P}${t}`,e);if(a.status===401||a.status===403){const s=await a.json();return console.error("❌ 인증 실패:",s.message),alert(s.message||"세션이 만료되었습니다. 다시 로그인해주세요."),localStorage.removeItem("accessToken"),window.location.href="/html/log.html",{ok:!1,status:a.status,json:async()=>s}}return a}catch(a){return console.error("❌ API 요청 오류:",a),{ok:!1,status:500,json:async()=>({message:"❌ API 요청 오류"})}}finally{r&&window.hideLoading()}}function I(t,n={}){return h(t,n,!1)}class S extends Error{}S.prototype.name="InvalidTokenError";async function O(){const t=await h("/model_admin_login?func=me");if(t.status===401||t.status===403){console.warn("🚫 인증 실패 - 로그인 페이지로 이동"),localStorage.removeItem("accessToken"),window.location.href="/html/log.html";return}const n=await t.json(),r=n==null?void 0:n.grade;if(!r){console.warn("❌ 사용자 grade 정보가 없습니다.");return}const l={"/html/01.notice.html":[1,2],"/html/01.notice-edit.html":[1,2],"/html/notice.html":[1,2]},o={1:"/html/dashboard.html",2:"/html/dashboard.html",3:"/html/franchise_dashboard.html",4:"/html/store_dashboard.html"},e=window.location.pathname,a=l[e];a&&!a.includes(r)&&(alert("이 페이지에 접근할 수 있는 권한이 없습니다."),window.location.href=o[r]||"/html/log.html")}async function k(){const t=await h("/model_admin_login?func=me");if(!t.ok)return console.warn("❌ 사용자 정보를 가져오지 못했습니다."),null;const n=await t.json();return{adminId:n.adminId,name:n.name,grade:n.grade}}async function A(){const n=await(await fetch("/partials/head.html")).text();document.head.innerHTML+=n;const l=await(await fetch("/partials/layout.html")).text(),o=document.createElement("div");o.innerHTML=l,document.body.prepend(o);const a=await(await fetch("/partials/header.html")).text(),s=document.createElement("div");if(s.innerHTML=a,document.body.prepend(s),window.location.pathname!=="/html/log.html"){const f=document.createElement("script");f.src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js",f.onload=()=>{const i=document.createElement("script");i.src="/js/common.js",document.body.appendChild(i)},document.head.appendChild(f)}}const D="userInfo";function E(){const t=localStorage.getItem(D);return t?JSON.parse(t):null}const H=async t=>await h(t,{method:"DELETE"}),R=async t=>await h(t,{method:"GET"}),U=async(t,n)=>await h(t,{method:"POST",body:JSON.stringify(n)}),N=async(t,n)=>await h(t,{method:"PUT",body:JSON.stringify(n)});function x(){console.log("📌 initDeviceManage 호출됨")}async function b(t,n,r){const l=await R(`/model_machine_registry?func=get-machine-status&userId=${t}`),{availableUrl:o,isOnline:e}=await l.json();e&&o?(w("✅ "+r),I("/model_machine_controll",{method:"POST",body:JSON.stringify({...n,userId:t})}).then(a=>{a.ok||console.warn("❌ 머신 명령 실패",a.status)}).catch(a=>{console.error("❌ 머신 통신 오류",a)})):w("❌ 머신이 오프라인입니다.",4e3,"error")}const M=Object.freeze(Object.defineProperty({__proto__:null,initDeviceManage:x,sendMachineCommand:b},Symbol.toStringTag,{value:"Module"}));window.sendMachineCommand=b;function j(){const t=document.getElementById("global-loading");t&&(t.style.display="flex")}function C(){const t=document.getElementById("global-loading");t&&(t.style.display="none")}window.showLoading=j;window.hideLoading=C;function w(t,n=3e3,r="success"){const l="toast-container";let o=document.getElementById(l);o||(o=document.createElement("div"),o.id=l,o.style.cssText=`
          position: fixed;
          top: 1rem;
          right: 2rem; /* ✅ 오른쪽 여백은 고정 */
          z-index: 9999;
          display: flex;
          flex-direction: column;
          align-items: center; /* ✅ 오른쪽 정렬 */
        `,document.body.appendChild(o));const e=document.createElement("div");e.textContent=t;const s={success:{background:"#e6fbe6",border:"2px solid #4CAF50",color:"#2e7d32"},error:{background:"#fde8e8",border:"2px solid #f44336",color:"#b71c1c"},warning:{background:"#fff8e1",border:"2px solid #ffb300",color:"#795548"}}[r];e.style.cssText=`
    background: ${s.background};
    color: ${s.color};
    border: ${s.border};
    padding: 0.8rem 1.2rem;
    margin-top: 0.5rem;
    border-radius: 0.5rem;
    font-size: 1.2rem;
    max-width: 320px;                /* ✅ 최대 너비 제한 */
    white-space: normal;             /* ✅ 줄바꿈 허용 */
    word-break: break-word;          /* ✅ 단어 길어도 줄바꿈 */
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    transition: all 0.3s ease;
    opacity: 0;
    transform: translateY(-10px);
  `,o.appendChild(e),requestAnimationFrame(()=>{e.style.opacity="1",e.style.transform="translateY(0)"}),setTimeout(()=>{e.style.opacity="0",e.style.transform="translateY(-10px)",setTimeout(()=>o==null?void 0:o.removeChild(e),300)},n)}window.showToast=w;document.addEventListener("DOMContentLoaded",async()=>{console.log("✅ main.ts 실행됨");const t=window.location.pathname;t!="/html/log.html"&&t!="/html/dashboard.html"&&(localStorage.getItem("authToken")?console.log("✅ 기존 세션 토큰 사용"):(console.log("🔄 자동로그인 시도"),await q()),await O(),await A(),$());const n=await k();if(n){const e=document.getElementById("user-name"),a=document.getElementById("user-grade");if(e&&(e.textContent=`${n.adminId} 님`),a){const s={1:"총괄관리자",2:"운영관리자",3:"프랜차이즈",4:"일반회원"}[n.grade]||"일반회원";a.innerHTML=`<span>${s}</span>`,a.classList.remove("manager","franchise","store"),n.grade===1&&a.classList.add("manager"),n.grade===3&&a.classList.add("franchise"),n.grade===4&&a.classList.add("store")}}const r=E();if(r){const e=document.querySelector(".user-menuWrap");e&&(e.style.display="block")}else{const e=document.querySelector(".user-menuWrap");e&&(e.style.display="none")}const l=document.querySelector(".sidemenu .menu"),o=document.createElement("li");if(o.innerHTML='<a href="/html/log.html"><p>로그아웃</p></a>',l==null||l.appendChild(o),!(r!=null&&r.payType)){const e=document.querySelector(".sidemenu .menu");[{href:"/html/point.html",label:"포인트"}].forEach(s=>{const d=document.createElement("li");d.innerHTML=`<a href="${s.href}"><p>${s.label}</p></a>`,e==null||e.appendChild(d)})}if(n&&n.grade<=2){const e=document.querySelector(".sidemenu .menu");[{href:"/html/notice.html?type=admin",label:"관리자 공지사항"},{href:"/html/notice.html?type=notice",label:"홈페이지 공지사항"},{href:"/html/notice.html?type=store",label:"설치매장"},{href:"/html/notice.html?type=news",label:"언론보도"},{href:"/html/notice.html?type=machine",label:"머신사용설명"},{href:"/html/empowerment.html",label:"권한 관리"}].forEach(s=>{const d=document.createElement("li");d.innerHTML=`<a href="${s.href}"><p>${s.label}</p></a>`,e==null||e.appendChild(d)})}t==="/index.html"||t==="/"?console.log("index 페이지"):t==="/html/log.html"?(console.log("📌 로그인 페이지 - login.ts 로드"),c(()=>import("./login-D4a44DZm.js"),[],import.meta.url).then(e=>{e.initLogin()})):t==="/html/home.html"?(console.log("📌 홈 페이지 - home.ts 로드"),c(()=>import("./home-B3iYgii_.js"),[],import.meta.url).then(e=>{e.initHome()})):t==="/html/point.html"?(console.log("📌 포인트 - point.ts 로드"),c(()=>import("./point-D-t53r7n.js"),[],import.meta.url).then(e=>{e.initPoint()})):t==="/html/product.html"?(console.log("📌 상품 - product.ts 로드"),c(()=>import("./product-CdRC6VXp.js"),[],import.meta.url).then(e=>{e.initProduct()})):t==="/html/product-detail.html"?(console.log("📌 상품상세 - productDetail.ts 로드"),c(()=>import("./productDetail-SxdPi9-K.js"),__vite__mapDeps([0,1]),import.meta.url).then(e=>{e.initProductDetail()})):t==="/html/product-add.html"?(console.log("📌 상품등록 - productAdd.ts 로드"),c(()=>import("./productAdd-vxFGRBeC.js"),__vite__mapDeps([2,1]),import.meta.url).then(e=>{e.initProductAdd()})):t==="/html/register.html"?(console.log("📌 회원가입 페이지 - register.ts 로드"),c(()=>import("./register-GwJ_7jb-.js"),[],import.meta.url).then(e=>{e.initRegister()})):t==="/html/notice.html"?(console.log("📌 관리자 공지사항등록 - notice.ts 로드"),c(()=>import("./notice-D7rP3lcY.js"),__vite__mapDeps([3,4]),import.meta.url).then(e=>{e.initNotice()})):t==="/html/franchise_dashboard.html"?(console.log("🏘️ 프랜차이즈 - franchise.ts 로드"),c(()=>import("./franchise-BqQbRFTF.js"),[],import.meta.url).then(e=>{e.franchiseEdit()})):t==="/html/store_dashboard.html"?(console.log("📌 데쉬보드 - store_dashboard.ts 로드"),c(()=>import("./store-p9FV3yAN.js"),[],import.meta.url).then(e=>{e.storeEdit()})):t==="/html/deviceManage.html"?(console.log("📌 머신관리 - deviceManage.ts 로드"),c(()=>Promise.resolve().then(()=>M),void 0,import.meta.url).then(e=>{e.initDeviceManage()})):t==="/html/sales.html"?(console.log("📌 매출 - sales.ts 로드"),c(()=>import("./sales-LDKZ8jWc.js"),[],import.meta.url).then(e=>{e.initSales()})):t==="/html/normalSet.html"?(console.log("📌 일반설정 - normalSet.ts 로드"),c(()=>import("./normalSet-DL9fQo_Y.js"),[],import.meta.url).then(e=>{e.initNormalSet()})):t==="/html/couponList.html"?(console.log("📌 쿠폰목록 - couponList.ts 로드"),c(()=>import("./couponList-CArdqh8m.js"),[],import.meta.url).then(e=>{e.initCouponList()})):console.log("📌 기본 페이지")});window.addEventListener("load",()=>{document.body.style.visibility="visible"});function $(){const t=E();if(!t){console.warn("❌ 사용자 정보 없음");return}const n=t.userId;document.querySelectorAll("a[data-func], button[data-func]").forEach(r=>{r.addEventListener("click",l=>{l.preventDefault();const o=r.dataset.func,e=r.dataset.msg||"명령이 전송되었습니다";if(o==="wash"||o==="pl"||o==="pa"||o==="restart"||o==="shutdown"){let s="";if(o==="wash"&&(s="기기세척을 진행하시겠습니까?"),o==="pl"&&(s="플라스틱컵을 배출하시겠습니까?"),o==="pa"&&(s="종이컵을 배출하시겠습니까?"),o==="restart"&&(s="프로그램을 재시작하시겠습니까?"),o==="shutdown"&&(s="프로그램을 종료하시겠습니까?"),!confirm(s))return}const a=r.id==="coffeeWash"?{data:[{type:"coffee"}]}:r.id==="wash"?{data:[{type:"coffee"},{type:"garucha",value1:"1"},{type:"garucha",value1:"2"},{type:"garucha",value1:"3"},{type:"garucha",value1:"4"},{type:"garucha",value1:"5"},{type:"garucha",value1:"6"},{type:"syrup",value1:"1"},{type:"syrup",value1:"2"},{type:"syrup",value1:"3"},{type:"syrup",value1:"5"},{type:"syrup",value1:"6"}]}:void 0;window.sendMachineCommand(n,a?{func:o,washData:a}:{func:o},e)})}),document.querySelectorAll("a[data-type][data-value], button[data-type][data-value]").forEach(r=>{r.addEventListener("click",l=>{l.preventDefault();const o=r.dataset.type,e=r.dataset.value,a=`${o==="garucha"?"가루차":"시럽"} ${e}번 세척`,s={data:[{type:o,value1:e}]};window.sendMachineCommand(n,{func:"wash",washData:s},a)})})}async function q(){const t="https://api.narrowroad-model.com",n=localStorage.getItem("refreshToken");if(!n){console.log("🔒 자동로그인 스킵: refreshToken 없음");return}console.log("🔄 자동로그인 시도 중...");try{const r=await fetch(`${t}/model_admin_login?func=refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:n})}),l=await r.json();console.log(l),r.ok?(localStorage.setItem("accessToken",l.accessToken),console.log("✅ 자동로그인 성공")):(console.warn("❌ 자동로그인 실패:",l.message||"Unknown error"),localStorage.removeItem("refreshToken"),v())}catch(r){console.error("❌ 자동로그인 요청 오류:",r),v()}}function v(){console.log("➡️ 로그인 페이지로 이동"),window.location.href="/html/log.html"}export{R as a,H as b,k as c,N as d,U as e,h as f,E as g};
