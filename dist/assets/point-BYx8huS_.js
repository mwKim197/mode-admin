var O=Object.defineProperty;var j=(t,e,o)=>e in t?O(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var f=(t,e,o)=>j(t,typeof e!="symbol"?e+"":e,o);import{a as L,g as v,b as q,c as J,d as A,e as R}from"./main-s1C98eLx.js";class U{constructor(e){f(this,"data");f(this,"pageSize");f(this,"blockSize");f(this,"container");f(this,"onPageChange");f(this,"currentPage");this.data=e.data,this.pageSize=e.pageSize||10,this.blockSize=e.blockSize||5,this.container=document.getElementById(e.containerId),this.onPageChange=e.onPageChange,this.currentPage=1,this.render(),this.movePage(1)}get totalPages(){return Math.ceil(this.data.length/this.pageSize)}render(){this.container.innerHTML="";const e=document.createElement("button");e.textContent="<",e.onclick=()=>this.moveBlock(-1),this.container.appendChild(e);for(let n=1;n<=this.totalPages;n++){const a=document.createElement("button");a.textContent=String(n),a.dataset.page=String(n),a.onclick=()=>this.movePage(n),this.container.appendChild(a)}const o=document.createElement("button");o.textContent=">",o.onclick=()=>this.moveBlock(1),this.container.appendChild(o),this.updateVisibleButtons()}movePage(e){if(e<1||e>this.totalPages)return;this.currentPage=e;const o=(e-1)*this.pageSize,n=o+this.pageSize,a=this.data.slice(o,n);this.onPageChange(a,e),this.updateActiveButton(),this.updateVisibleButtons()}moveBlock(e){const a=(Math.floor((this.currentPage-1)/this.blockSize)+e)*this.blockSize+1;a<1||a>this.totalPages||this.movePage(a)}updateActiveButton(){this.container.querySelectorAll("button").forEach(o=>{o.dataset.page&&o.classList.toggle("active",Number(o.dataset.page)===this.currentPage)})}updateVisibleButtons(){const e=this.container.querySelectorAll("button"),o=Math.floor((this.currentPage-1)/this.blockSize);e.forEach(n=>{if(!n.dataset.page)return;const a=Number(n.dataset.page),r=o*this.blockSize+1,s=r+this.blockSize-1;a>=r&&a<=s?n.style.display="inline-block":n.style.display="none"})}}function V({data:t,currentPage:e,limit:o,onPageChange:n,containerId:a}){const r=Math.ceil(t.total/o),s=t.pageKeys?JSON.parse(t.pageKeys):[],g=document.getElementById(a);if(!g)return;g.innerHTML="";const c=5;let p=Math.max(1,e-Math.floor(c/2)),u=p+c-1;u>r&&(u=r,p=Math.max(1,u-c+1));const m=document.createElement("button");m.innerHTML="&lt;",m.disabled=e===1,m.addEventListener("click",()=>{e>1&&n(e-1===1?null:s[e-3]||null,e-1)}),g.appendChild(m);for(let i=p;i<=u;i++){const l=document.createElement("button");l.setAttribute("data-page",String(i)),l.innerText=String(i),l.style.display="inline-block",i===e&&l.classList.add("active"),l.addEventListener("click",()=>{const w=i===1?null:s[i-2]||null;n(w,i)}),g.appendChild(l)}const d=document.createElement("button");d.innerHTML="&gt;",d.disabled=e===r,d.addEventListener("click",()=>{e<r&&n(s[e-1]||null,e+1)}),g.appendChild(d)}async function F(t){const e=await L(`/model_user_setting?func=get-user&userId=${t}`);if(!e.ok){const n=await e.json();return console.error("ğŸ”´ ì‘ë‹µ ë³¸ë¬¸:",n),alert("âŒ ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤."),null}const{user:o}=await e.json();return o}let B=!1,E=[],y,G=1;const S=10;let b={},k=!1,P=null;async function te(){const t=v();if(!t){window.showToast("ì‚¬ìš©ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.",2e3,"error");return}X((t==null?void 0:t.isPhone)??!0);const e=document.getElementById("popupTel");e&&D(e),document.getElementById("earnMileage").value=String(t.earnMileage??""),document.getElementById("mileageNumber").value=String(t.mileageNumber??""),document.getElementById("isPhone").checked=t.isPhone??!1;const o=document.getElementById("isPhone"),n=document.getElementById("mileageNumber");o&&n&&(o.addEventListener("change",()=>{o.checked?(n.value="11",n.disabled=!0,n.placeholder="íœ´ëŒ€í°ë²ˆí˜¸ 11ìë¦¬ ê³ ì •"):(n.disabled=!1,n.value="",n.placeholder="4-12")}),o.checked&&(n.value="11",n.disabled=!0,n.placeholder="íœ´ëŒ€í°ë²ˆí˜¸ 11ìë¦¬ ê³ ì •"));const a=document.getElementById("selectAllBtn");if(!a)return;a.addEventListener("click",function(){B=!B,document.querySelectorAll("input.row-checkbox").forEach(l=>{l.checked=B}),a.className=B?"btn-s mb10":"btn-s blue mb10",a.textContent=B?"ì „ì²´í•´ì œ":"ì „ì²´ì„ íƒ"}),document.getElementById("pointInfoSave").addEventListener("click",async function(){await W()});const s=document.getElementById("searchNumber"),g=document.getElementById("searchButton"),c=document.getElementById("searchReset");g.addEventListener("click",()=>{const i=s.value.trim();if(!i){window.showToast("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.",2e3,"warning");return}N(i,!0)}),c.addEventListener("click",()=>{s.value="",x(E)}),s.addEventListener("keypress",function(i){if(i.key==="Enter"){const l=s.value.trim();if(!l){window.showToast("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.",2e3,"warning");return}N(l,!0)}}),s.addEventListener("input",function(){const i=s.value.trim();P&&clearTimeout(P),P=setTimeout(()=>{N(i,!1)},300)}),document.querySelectorAll(".popupCloseBtn").forEach(i=>{i.addEventListener("click",()=>{_()})}),document.getElementById("saveButton").addEventListener("click",async()=>{k?await C("update"):await C("create")}),document.getElementById("createPointBtn").addEventListener("click",()=>{y=void 0,k=!1,z()});const d=document.getElementById("deleteButton");d&&d.addEventListener("click",async()=>{const i=document.querySelectorAll("input.row-checkbox:checked");if(i.length===0){window.showToast("ì‚­ì œí•  í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.",2e3,"warning");return}if(!confirm(`ì„ íƒí•œ ${i.length}ê°œ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))return;const w=v();if(!w){window.showToast("ì‚¬ìš©ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.",2e3,"error");return}const h=w.userId;let I=0;for(const H of i){const T=H.dataset.id;if(!T)continue;(await q(`/model_admin_mileage?func=mileage-delete&userId=${h}&uniqueMileageNo=${T}`)).ok||(I++,console.error(`âŒ ì‚­ì œ ì‹¤íŒ¨: ${T}`))}I>0?window.showToast(`âŒ ${I}ê±´ ì‚­ì œ ì‹¤íŒ¨`,2e3,"error"):window.showToast("âœ… ì„ íƒëœ ë§ˆì¼ë¦¬ì§€ë¥¼ ëª¨ë‘ ì‚­ì œí–ˆìŠµë‹ˆë‹¤."),await $()}),await $()}function N(t,e){let o;t.length>0?o=E.filter(n=>{var a,r;return((a=n.mileageNo)==null?void 0:a.includes(t))||((r=n.tel)==null?void 0:r.includes(t))}):o=E,x(o),e&&o.length===0&&t.length>0&&window.showToast(`"${t}"ì— ëŒ€í•œ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.`,2e3,"warning")}async function z(){const t=document.querySelector(".popup-overlay");t.style.display="flex";const e=document.getElementById("saveButton");e.textContent=k?"ìˆ˜ì •":"ì €ì¥",document.getElementById("mileageNo").value="",document.getElementById("popupTel").value="",document.getElementById("popupPassword").value="",document.getElementById("popupMileage").value="",document.getElementById("popupCount").value="",document.getElementById("popupAmount").value="",document.getElementById("myTextarea").value=""}function _(){const t=document.querySelector(".popup-overlay");t.style.display="none"}async function W(){const t=v();if(!t){window.showToast("ì‚¬ìš©ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.",2e3,"error");return}const e=await J(),o=e==null?void 0:e.adminId,n=parseInt(document.getElementById("earnMileage").value,10),a=parseInt(document.getElementById("mileageNumber").value,10),r=document.getElementById("isPhone");if(!n){window.showToast("ë§ˆì¼ë¦¬ì§€ ì ë¦½ë¥ ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.",2e3,"warning");return}if(100<n){window.showToast("ë§ˆì¼ë¦¬ì§€ ì ë¦½ë¥ ì€ 0~100 ì‚¬ì´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.",2e3,"warning");return}if(!a){window.showToast("ë§ˆì¼ë¦¬ì§€ ì ë¦½ ë²ˆí˜¸ ìë¦¬ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.",2e3,"warning");return}if(4>a||12<a){window.showToast("ë§ˆì¼ë¦¬ì§€ ì ë¦½ë²ˆí˜¸ ìë¦¬ìˆ˜ëŠ” 4-12ìë¦¬ ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.",2e3,"warning");return}const s={userId:t.userId,adminId:o,isPhone:r.checked,earnMileage:n,mileageNumber:a};if(!(await A("/model_user_setting?func=update-user",s)).ok){console.error("âŒ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨");return}const c=await F(t.userId);c&&(localStorage.setItem("userInfo",JSON.stringify(c)),window.showToast("âœ… ì‚¬ìš©ì ì •ë³´ ì €ì¥ ì™„ë£Œ"))}async function $(){const t=v();if(!t){window.showToast("ì‚¬ìš©ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.",2e3,"error");return}const e=t.userId,o=await L(`/model_admin_mileage?userId=${e}&func=mileage&limit=1000`);if(!o.ok){console.error("âŒ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨");return}E=(await o.json()).items||[],await x(E)}async function x(t){new U({data:t,pageSize:10,blockSize:5,containerId:"pagination",onPageChange:(e,o)=>{const n=document.querySelector("tbody"),a=document.getElementById("selectAllBtn");if(!n||!a)return;B=!1,a.textContent="ì „ì²´ì„ íƒ",n.innerHTML="";const r=document.getElementById("popupAmount");r.addEventListener("click",()=>{r.value=r.value.replace(/[^0-9]/g,"")}),r.addEventListener("blur",()=>{const s=r.value.replace(/[^0-9]/g,"");s?r.value=Number(s).toLocaleString()+"p":r.value="0p"}),e.forEach((s,g)=>{const c=document.createElement("tr"),p=s.amount??0;c.innerHTML=`
                  <td><input type="checkbox" class="row-checkbox" data-id="${s.uniqueMileageNo}"></td>
                  <td>${g+1+(o-1)*10}</td>
                  <td>${M(s.mileageNo)}</td>
                  <td>${Number(p).toLocaleString()}p</td>
                  <td><button class="btn-delete" data-id="${s.uniqueMileageNo}">ì‚­ì œ</button></td>
                `,c.addEventListener("click",async m=>{const d=m.target;if(d.closest("input[type='checkbox']")||d.closest(".btn-delete"))return;const i=s;y=i,k=!0,await z();const l=await K(y,G),w=(l==null?void 0:l.total)||0;document.getElementById("popupCount").value=`${w}ê±´`,document.getElementById("popupCount").readOnly=!0,document.getElementById("mileageNo").value=M(i.mileageNo??""),document.getElementById("popupTel").value=M(i.tel??""),document.getElementById("popupPassword").value=i.password??"",document.getElementById("popupMileage").value=String(Number(p).toLocaleString()??"0")+"p",document.getElementById("popupAmount").value=String(Number(p).toLocaleString()??"0")+"p",document.getElementById("myTextarea").value=i.note??""});const u=c.querySelector(".btn-delete");u.onclick=async()=>{if(!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?"))return;const d=v();if(!d){window.showToast("ì‚¬ìš©ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.",2e3,"error");return}const i=d.userId;if(!(await q(`/model_admin_mileage?userId=${i}&func=mileage-delete&uniqueMileageNo=${s.uniqueMileageNo}`)).ok){window.showToast("âŒ ì‚­ì œ ì‹¤íŒ¨",2e3,"error");return}window.showToast("âœ… ì‚­ì œ ì™„ë£Œ"),await $()},n.appendChild(c)})}})}async function C(t){try{const e=document.getElementById("mileageNo").value.trim(),o=document.getElementById("popupTel").value.trim(),n=document.getElementById("popupPassword").value.trim(),a=document.getElementById("popupAmount").value.trim(),r=a.replace(/[^0-9]/g,""),s=document.getElementById("myTextarea").value.trim(),g=v();if(!g){window.showToast("ì‚¬ìš©ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.",2e3,"error");return}const{userId:c,isPhone:p,mileageNumber:u}=g;if(!c||p===void 0||u===void 0){window.showToast(`ğŸ“Œ ê³ ê°ë²ˆí˜¸ ì„¤ì •ì´ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.
[íœ´ëŒ€í° ì—¬ë¶€ / ìë¦¿ìˆ˜] ì •ë³´ë¥¼ ë¨¼ì € ë“±ë¡í•´ì£¼ì„¸ìš”.`,2e3,"warning");return}const m=Q(e,p,u);if(m){window.showToast(m,2e3,"warning");return}const d=p?e.replace(/-/g,""):e;if(t==="create"){const h=o?n?a?null:"í¬ì¸íŠ¸":"íŒ¨ìŠ¤ì›Œë“œ":"ì „í™”ë²ˆí˜¸";if(h){window.showToast(`í•„ìˆ˜ í•­ëª© ${h} ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.`,2e3,"warning");return}}else{const h=o?n?null:"íŒ¨ìŠ¤ì›Œë“œ":"ì „í™”ë²ˆí˜¸";if(h){window.showToast(`í•„ìˆ˜ í•­ëª© ${h} ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.`,2e3,"warning");return}}if(!/^\d+$/.test(n)){window.showToast("ë¹„ë°€ë²ˆí˜¸ëŠ” ìˆ«ìë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”.",2e3,"warning");return}if(r&&!/^\d+$/.test(r)){window.showToast("í¬ì¸íŠ¸ëŠ” ìˆ«ìë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”.",2e3,"warning");return}const i={userId:c,mileageNo:d,password:n,points:r,tel:o};if(s&&(i.note=s),t==="update"){if(!(y!=null&&y.uniqueMileageNo)){window.showToast("ì„ íƒëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.",2e3,"warning");return}i.uniqueMileageNo=y.uniqueMileageNo,i.newPassword=n,delete i.password}const l=t==="create"?`/model_admin_mileage?userId=${c}&func=mileage-add`:"/model_admin_mileage?func=mileage-update",w=t==="create"?await R(l,i):await A(l,i);if(!w.ok){try{const h=await w.json(),I=(h==null?void 0:h.message)??`${t==="create"?"ë“±ë¡":"ìˆ˜ì •"} ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.`;window.showToast(`âŒ ${I}`,2e3,"error")}catch{window.showToast(`âŒ ${t==="create"?"ë“±ë¡":"ìˆ˜ì •"} ì‹¤íŒ¨`,2e3,"error")}return}window.showToast(`âœ… ${t==="create"?"ë“±ë¡":"ìˆ˜ì •"} ì™„ë£Œ`),_(),await $()}catch(e){console.error(`âŒ ${t} ì˜¤ë¥˜:`,e),window.showToast(`ì„œë²„ ì˜¤ë¥˜ë¡œ ${t==="create"?"ë“±ë¡":"ìˆ˜ì •"}ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.`,2e3,"error")}}async function K(t,e=1){const o=v();if(!o)return;const n=b[e-1];let a=`/model_admin_mileage?func=mileage-history&userId=${o.userId}&uniqueMileageNo=${t.uniqueMileageNo}&limit=${S}`;n&&(a+=`&lastEvaluatedKey=${encodeURIComponent(JSON.stringify(n))}`);const r=await L(a),{items:s,total:g,pageKeys:c}=await r.json();if(b={},c)try{JSON.parse(c).forEach((m,d)=>{b[d+1]=m})}catch(u){console.warn("âš ï¸ pageKeys íŒŒì‹± ì‹¤íŒ¨:",u)}const p=document.getElementById("historyTableBody");if(p)return p.innerHTML="",s.forEach((u,m)=>{const d=document.createElement("tr"),i=u.timestamp.split("T")[0],l=u.timestamp.split("T")[1].split(".")[0];d.innerHTML=`
            <td>${m+1+(e-1)*S}</td>
            <td>${i}</td>
            <td>${l}</td>
            <td>${Number(u.totalAmt??0).toLocaleString()}ì›</td>
            <td>${u.points}p</td>
            <td>${Number(u.amount).toLocaleString()}p</td>
        `,p.appendChild(d)}),V({data:{total:g,pageKeys:c},currentPage:e,limit:S,containerId:"historyPagination",onPageChange:(u,m)=>{b[m-1]=u,K(t,m)}}),{items:s,total:g}}function Q(t,e,o){const n=t.trim(),a=e?n.replace(/-/g,""):n;return/^\d+$/.test(a)?a.length!==o?`í¬ì¸íŠ¸ ë²ˆí˜¸ëŠ” ${o}ìë¦¬ì—¬ì•¼ í•©ë‹ˆë‹¤.`:null:"í¬ì¸íŠ¸ ë²ˆí˜¸ëŠ” ìˆ«ìë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”."}function X(t){const e=document.getElementById("mileageNo");e&&(e.value="",e.placeholder=t?"010-1234-5678":"ìˆ«ìë§Œ ì…ë ¥",e.addEventListener("input",o=>{let n=o.target.value.replace(/\D/g,"");t?D(e):e.value=n}))}function D(t){t.addEventListener("input",()=>{const e=t.value.replace(/\D/g,"").slice(0,11);e.length<=3?t.value=e:e.length<=7?t.value=`${e.slice(0,3)}-${e.slice(3)}`:t.value=`${e.slice(0,3)}-${e.slice(3,7)}-${e.slice(7)}`})}function M(t){const e=t.replace(/\D/g,"");if(e.startsWith("02")){if(e.length===9)return`${e.slice(0,2)}-${e.slice(2,5)}-${e.slice(5)}`;if(e.length===10)return`${e.slice(0,2)}-${e.slice(2,6)}-${e.slice(6)}`}return e.length===10?`${e.slice(0,3)}-${e.slice(3,6)}-${e.slice(6)}`:e.length===11?`${e.slice(0,3)}-${e.slice(3,7)}-${e.slice(7)}`:e}export{D as applyPhoneInputFormat,te as initPoint};
