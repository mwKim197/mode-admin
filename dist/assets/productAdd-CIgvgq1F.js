import{r as U,h as V,v as M,a as C}from"./imageUploader-DUCDfXOZ.js";import{g as N,e as Y,f as H}from"./main-CldzeuS0.js";let f,I;async function G(){const r=document.querySelector(".back-box");r&&(r.style.display="flex");const e=N();if(!e){window.showToast("사용자 정보가 없습니다.",3e3,"error");return}await U(null),document.getElementById("logoUpload").addEventListener("change",async n=>{await O(n)});const s=document.getElementById("saveDtlBtn");if(s){let n=function(){var t;const c=(t=document.querySelector('input[name="iceYn"]:checked'))==null?void 0:t.value;d&&(d.style.display=c==="no"?"none":"block")},a=function(){var l;const t=((l=document.querySelector('input[name="cupYn"]:checked'))==null?void 0:l.value)==="yes",u=e==null?void 0:e.barcodeScanner;y&&(y.style.display=t?"none":"block"),p&&(p.style.display=t?"none":"block"),w&&(w.style.display=t?"none":"block");const m=document.getElementById("barcode-box");m&&(m.style.display=t&&u?"block":"none")};s.addEventListener("click",async()=>{const c=j(e.userId);if(!f||!I){window.showToast("이미지 등록은 필수입니다.",3e3,"warning");return}const t=M(c);if(t){window.showToast(t,3e3,"warning");return}const u=C(c);if(u){window.showToast(u,3e3,"warning");return}if(confirm("신규 메뉴를 등록하시겠습니까?")){const m={userId:e.userId,data:c,...f&&I&&{originalFileName:I,imageBase64:f}};try{if(!(await Y("/model_admin_menu?func=set-new-menu",m)).ok){window.showToast("신규 메뉴 등록에 실패하였습니다.",3e3,"error");return}window.showToast("신규 메뉴가 등록되었습니다."),setTimeout(()=>{window.location.href="/html/product.html"},1e3)}catch(l){console.error("등록 중 오류 발생:",l),window.showToast("오류가 발생했습니다.",3e3,"error")}}});const d=document.getElementById("ice-water-time-box");n();const i=document.querySelectorAll('input[name="cupYn"]'),y=document.getElementById("items-container"),p=document.getElementById("cup-ice-selection-box"),w=document.getElementById("ice-water-time-box");i.forEach(c=>{c.addEventListener("change",a)}),a(),W()}}async function O(r){const e=r.target,o=document.getElementById("logoPreview"),s=document.getElementById("fileName");if(!s){window.showToast("에러발생",3e3,"error");return}try{const{base64:n,fileName:a}=await V(e,o,s);f=n,I=a}catch(n){window.showToast("이미지 업로드 실패",3e3,"error"),console.warn("이미지 업로드 실패:",n)}}function W(){const r=document.getElementById("barcode-input"),e=document.getElementById("barcode-scan-btn");if(!r||!e){console.log("바코드 요소를 찾을 수 없습니다");return}e.addEventListener("click",async()=>{try{const o=N();if(!o){window.showToast("사용자 정보가 없습니다.",3e3,"error");return}if((await Y("/model_machine_controll",{userId:o.userId,func:"barcode"})).ok){window.showToast("바코드를 스캔해주세요",2e3);const n=setInterval(async()=>{const a=await H("/model_barcode_scan?func=barcode-claim-latest",{method:"POST",body:JSON.stringify({userId:o.userId})});if(a.ok){const d=await a.json();if(d.found&&d.code){clearInterval(n);const i=document.getElementById("barcode-input");i&&(i.value=d.code,i.setAttribute("data-field","barcode"))}}},1e3)}else window.showToast("바코드 스캔 시작에 실패했습니다.",3e3,"error")}catch(o){console.error("바코드 스캔 API 오류:",o),window.showToast("바코드 스캔 중 오류가 발생했습니다.",3e3,"error")}})}function j(r){var v,h,b,B,E;const o=Number(document.getElementById("menu-no").value),s=document.getElementById("menu-name").value,n=document.getElementById("menu-price").value.trim(),a=document.getElementById("menu-category").value,d=((v=document.querySelector('input[name="cupYn"]:checked'))==null?void 0:v.value)||"no",i=((h=document.querySelector('input[name="cup"]:checked'))==null?void 0:h.value)||"",y=((b=document.querySelector('input[name="iceYn"]:checked'))==null?void 0:b.value)||"",p=((B=document.querySelector('input[name="empty"]:checked'))==null?void 0:B.value)||"",w=document.getElementById("ice-time").value.trim(),c=document.getElementById("water-time").value.trim(),t=((E=document.getElementById("barcode-input"))==null?void 0:E.value.trim())||"",u="",m={best:document.getElementById("state-best").value,event:document.getElementById("state-event").value,new:document.getElementById("state-new").value},l=Array.from(document.querySelectorAll(".item")).map((S,D)=>{var T,x,q,A,F;const k=((T=S.querySelector(".item-type-select"))==null?void 0:T.value)||"",g=S.querySelectorAll("input"),P=String(parseFloat(((x=g[0])==null?void 0:x.value)||"0")),_=String(parseFloat(((q=g[1])==null?void 0:q.value)||"0")),L=String(parseFloat(((A=g[2])==null?void 0:A.value)||"0")),R=k==="garucha"?"0":String(parseFloat(((F=g[3])==null?void 0:F.value)||"0"));return{no:String(D+1),type:k,value1:P,value2:_,value3:L,value4:R}});return{userId:r,menuId:0,no:o,name:s,price:n,category:a,cupYn:d,cup:i,empty:p,iceYn:y,iceTime:w,waterTime:c,barcode:t,image:u,state:m,items:l}}export{G as initProductAdd};
