import{s as w}from"./main-BTQuD9qN.js";const u="https://api.narrowroad-model.com";function _(){console.log("âœ… login.ts ë¡œë“œë¨"),localStorage.removeItem("accessToken"),localStorage.removeItem("userInfo");const t=document.getElementById("login-form");if(!t){console.error("âŒ ë¡œê·¸ì¸ í¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ");return}t.addEventListener("submit",async o=>{o.preventDefault(),localStorage.removeItem("accessToken"),localStorage.removeItem("userInfo"),console.log("ğŸ—‘ï¸ ê¸°ì¡´ ë¡œê·¸ì¸ í† í° ì‚­ì œë¨");const n=document.getElementById("adminId").value.trim(),e=document.getElementById("password").value.trim(),a=document.getElementById("agree").checked;if(!n||!e){alert("ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");return}window.showLoading();try{const r=await fetch(`${u}/model_admin_login?func=login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({adminId:n,password:e})}),l=await r.json();r.ok?await k(l,a):alert(l.message||"ë¡œê·¸ì¸ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.")}catch(r){console.error("âŒ ë¡œê·¸ì¸ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:",r),alert("ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.")}finally{window.hideLoading()}});const s=document.getElementById("kakao-login-btn");s&&s.addEventListener("click",I)}function I(){const t="240886095629b93f9655026145a39487",s="https://zeroadmin.kr/html/kakao-callback.html",o=new Uint8Array(16);crypto.getRandomValues(o);const n=Array.from(o).map(d=>d.toString(16).padStart(2,"0")).join("");sessionStorage.setItem("kakao_state",n);const e=`https://kauth.kakao.com/oauth/authorize?response_type=code&client_id=${encodeURIComponent(t)}&redirect_uri=${encodeURIComponent(s)}&state=${encodeURIComponent(n)}`,a=window.matchMedia("(max-width: 768px)").matches,r=document.getElementById("agree"),l=!!(r!=null&&r.checked),p=async d=>{if(d.origin!==window.location.origin)return;const m=d.data||{};if(m.type!=="kakao-auth")return;const g=sessionStorage.getItem("kakao_state");if(!g||m.state!==g){console.warn("Invalid state",{got:m.state,expected:g}),alert("ë¡œê·¸ì¸ ë³´ì•ˆ ê²€ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");return}const{code:h,error:f}=m;if(f||!h){console.error("âŒ Kakao OAuth error or code missing:",f),alert("ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.");return}try{const c=await fetch(`${u}/model_admin_login?func=kakao-login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:h,state:g})}),i=await c.json();c.ok&&i.accessToken?await k(i,l):c.ok&&i.redirectUrl?window.location.href=i.redirectUrl:(console.error("âŒ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì‹¤íŒ¨ ì‘ë‹µ:",i),alert("ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”."))}catch(c){console.error("âŒ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ìš”ì²­ ì˜¤ë¥˜:",c),alert("ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.")}};if(a){window.location.href=e;return}window.addEventListener("message",p,{once:!0}),window.open(e,"kakaoLogin","width=500,height=700")||(window.location.href=e)}async function k(t,s=!1){try{localStorage.setItem("accessToken",t.accessToken),s?(console.log("âœ… ë¡œê·¸ì¸ ì„±ê³µ â†’ ìë™ë¡œê·¸ì¸ í™œì„±í™”"),localStorage.setItem("refreshToken",t.refreshToken)):(console.log("âœ… ë¡œê·¸ì¸ ì„±ê³µ â†’ ìë™ë¡œê·¸ì¸ ì‚­ì œ"),localStorage.removeItem("refreshToken")),console.log("âœ… ë¡œê·¸ì¸ ì„±ê³µ â†’ í† í° ì €ì¥ ì™„ë£Œ!");const o=await fetch(`${u}/model_admin_login?func=me`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.accessToken}`},mode:"cors"});if(!o.ok){console.error("âŒ ì‚¬ìš©ì ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:",o.status),alert("ìœ ì € ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");return}const n=await o.json();if(n.userId){const e=await fetch(`${u}/model_user_setting?func=get-user&userId=${n.userId}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.accessToken}`},mode:"cors"});if(e.ok){const{user:a}=await e.json();w(a),console.log("âœ… ì‚¬ìš©ì ì •ë³´ ì €ì¥ ì™„ë£Œ")}else{const a=await e.text();console.error("âŒ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:",e.status,a),alert("ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");return}}window.location.href="/html/home.html"}catch(o){console.error("âŒ postLogin ì²˜ë¦¬ ì˜¤ë¥˜:",o),alert("ë¡œê·¸ì¸ í›„ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}}export{_ as initLogin};
