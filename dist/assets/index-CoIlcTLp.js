(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function r(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function s(e){if(e.ep)return;e.ep=!0;const t=r(e);fetch(e.href,t)}})();const a="https://api.narrowroad-model.com";async function c(o,n={}){const r=localStorage.getItem("authToken");if(!r)return window.location.pathname.includes("index.html")||window.location.pathname==="/"||(console.log("❌ 토큰이 없습니다. 로그인 페이지로 이동합니다."),window.location.href="/index.html"),null;const s={...n,headers:{...n.headers,Authorization:`Bearer ${r}`,"Content-Type":"application/json"}};try{const e=await fetch(`${a}/model_admin_login${o}`,s);if(e.status===401)return console.error("❌ 인증 실패: 토큰이 만료되었습니다."),localStorage.removeItem("authToken"),alert("세션이 만료되었습니다. 다시 로그인하세요."),window.location.href="/index.html",null;if(!e.ok)throw new Error(`❌ 요청 실패: ${e.statusText}`);return await e.json()}catch(e){return console.error("❌ API 요청 오류:",e),null}}async function l(){const o=await c("?func=me");o?console.log("✅ 사용자 정보:",o):console.log("❌ 사용자 정보를 가져오지 못했습니다.")}const d="https://api.narrowroad-model.com";document.addEventListener("DOMContentLoaded",()=>{console.log("✅ login.ts 파일이 정상적으로 로드되었습니다.");const o=document.getElementById("login-form");if(!o){console.error("❌ 로그인 폼을 찾을 수 없습니다.");return}o.addEventListener("submit",async n=>{n.preventDefault();const r=document.getElementById("userId").value.trim(),s=document.getElementById("password").value.trim();if(!r||!s){alert("아이디와 비밀번호를 입력해주세요.");return}try{const e=await fetch(`${d}/model_admin_login?func=login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:r,password:s}),mode:"cors"}),t=await e.json();e.ok?(localStorage.setItem("authToken",t.token),console.log("✅ 로그인 성공 → 토큰 저장 완료!"),window.location.href="/html/main.html"):alert(t.message||"로그인 실패. 다시 시도하세요.")}catch(e){console.error("❌ 로그인 오류:",e),alert("서버 오류가 발생했습니다. 다시 시도하세요.")}})});document.addEventListener("DOMContentLoaded",()=>{l()});
