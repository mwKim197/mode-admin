import{r as U,h as V,v as M,a as C}from"./imageUploader-Bo-Egzif.js";import{g as F,e as N,f as O}from"./main-BTQuD9qN.js";let g,f;async function G(){const r=document.querySelector(".back-box");r&&(r.style.display="flex");const c=F();if(!c){window.showToast("사용자 정보가 없습니다.",3e3,"error");return}await U(null),document.getElementById("logoUpload").addEventListener("change",async e=>{await W(e)});const s=document.getElementById("saveDtlBtn");if(s){let e=function(){var n;const t=(n=document.querySelector('input[name="iceYn"]:checked'))==null?void 0:n.value;i&&(i.style.display=t==="no"?"none":"block")},a=function(){var l;const n=((l=document.querySelector('input[name="cupYn"]:checked'))==null?void 0:l.value)==="yes";m&&(m.style.display=n?"none":"block"),y&&(y.style.display=n?"none":"block"),p&&(p.style.display=n?"none":"block")};s.addEventListener("click",async()=>{const t=H(c.userId);if(!g||!f){window.showToast("이미지 등록은 필수입니다.",3e3,"warning");return}const n=M(t);if(n){window.showToast(n,3e3,"warning");return}const l=C(t);if(l){window.showToast(l,3e3,"warning");return}if(confirm("신규 메뉴를 등록하시겠습니까?")){const I={userId:c.userId,data:t,...g&&f&&{originalFileName:f,imageBase64:g}};try{if(!(await N("/model_admin_menu?func=set-new-menu",I)).ok){window.showToast("신규 메뉴 등록에 실패하였습니다.",3e3,"error");return}window.showToast("신규 메뉴가 등록되었습니다."),setTimeout(()=>{window.location.href="/html/product.html"},1e3)}catch(u){console.error("등록 중 오류 발생:",u),window.showToast("오류가 발생했습니다.",3e3,"error")}}});const d=document.querySelectorAll('input[name="iceYn"]'),i=document.getElementById("ice-water-time-box");d.forEach(t=>{t.addEventListener("change",e)}),e();const v=document.querySelectorAll('input[name="cupYn"]'),m=document.getElementById("items-container"),y=document.getElementById("cup-ice-selection-box"),p=document.getElementById("ice-water-time-box");v.forEach(t=>{t.addEventListener("change",a)}),a(),j()}}async function W(r){const c=r.target,o=document.getElementById("logoPreview"),s=document.getElementById("fileName");if(!s){window.showToast("에러발생",3e3,"error");return}try{const{base64:e,fileName:a}=await V(c,o,s);g=e,f=a}catch(e){window.showToast("이미지 업로드 실패",3e3,"error"),console.warn("이미지 업로드 실패:",e)}}function j(){const r=document.getElementById("barcode-input"),c=document.getElementById("barcode-scan-btn");if(!r||!c){console.log("바코드 요소를 찾을 수 없습니다");return}c.addEventListener("click",async()=>{try{const o=F();if(!o){window.showToast("사용자 정보가 없습니다.",3e3,"error");return}if((await N("/model_machine_controll",{userId:o.userId,func:"barcode"})).ok){window.showToast("바코드를 스캔해주세요",2e3);const e=setInterval(async()=>{const a=await O("/model_barcode_scan?func=barcode-claim-latest",{method:"POST",body:JSON.stringify({userId:o.userId})});if(a.ok){const d=await a.json();if(d.found&&d.code){clearInterval(e);const i=document.getElementById("barcode-input");i&&(i.value=d.code,i.setAttribute("data-field","barcode"))}}},1e3)}else window.showToast("바코드 스캔 시작에 실패했습니다.",3e3,"error")}catch(o){console.error("바코드 스캔 API 오류:",o),window.showToast("바코드 스캔 중 오류가 발생했습니다.",3e3,"error")}})}function H(r){var u,h,B,b,E;const o=Number(document.getElementById("menu-no").value),s=document.getElementById("menu-name").value,e=document.getElementById("menu-price").value.trim(),a=document.getElementById("menu-category").value,d=((u=document.querySelector('input[name="cupYn"]:checked'))==null?void 0:u.value)||"no",i=((h=document.querySelector('input[name="cup"]:checked'))==null?void 0:h.value)||"",v=((B=document.querySelector('input[name="iceYn"]:checked'))==null?void 0:B.value)||"",m=((b=document.querySelector('input[name="empty"]:checked'))==null?void 0:b.value)||"",y=document.getElementById("ice-time").value.trim(),p=document.getElementById("water-time").value.trim(),t=((E=document.getElementById("barcode-input"))==null?void 0:E.value.trim())||"",n="",l={best:document.getElementById("state-best").value,event:document.getElementById("state-event").value,new:document.getElementById("state-new").value},I=Array.from(document.querySelectorAll(".item")).map((S,D)=>{var T,q,x,A,Y;const k=((T=S.querySelector(".item-type-select"))==null?void 0:T.value)||"",w=S.querySelectorAll("input"),L=String(parseFloat(((q=w[0])==null?void 0:q.value)||"0")),P=String(parseFloat(((x=w[1])==null?void 0:x.value)||"0")),R=String(parseFloat(((A=w[2])==null?void 0:A.value)||"0")),_=k==="garucha"?"0":String(parseFloat(((Y=w[3])==null?void 0:Y.value)||"0"));return{no:String(D+1),type:k,value1:L,value2:P,value3:R,value4:_}});return{userId:r,menuId:0,no:o,name:s,price:e,category:a,cupYn:d,cup:i,empty:m,iceYn:v,iceTime:y,waterTime:p,barcode:t,image:n,state:l,items:I}}export{G as initProductAdd};
