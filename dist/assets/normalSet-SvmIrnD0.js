import{a as F,d as C,e as L}from"./main-DhEZJ_Ft.js";let w=null,p=null,g="",B="",v=!1,h=!1;function G(){z(),A(),R()}function A(){const n=document.querySelector(".btn-outline");n&&n.addEventListener("click",o=>{o.preventDefault(),_()})}let e=null;async function z(){try{const o=JSON.parse(localStorage.getItem("userInfo")||"{}").userId;if(!o)return;const t=await(await F(`/model_user_setting?func=get-user&userId=${o}`)).json();if(t&&t.user){e=t.user;const s=document.getElementById("storeNm");s&&(s.value=t.user.storeName||"");const u=document.querySelector("#tel-input");u&&(u.value=t.user.tel||"");const r=document.getElementById("businessNo");r&&(r.value=t.user.businessNo||"");const m=document.querySelector('.in-box input[type="text"]');m&&(m.value=t.user.limitCount||"");const d=document.querySelector("#wash-time-input");d&&(d.value=t.user.washTime||"");const f=document.querySelector("#remote-address");f&&(f.value=t.user.remoteAddress||"");const E=document.querySelectorAll('input[type="checkbox"]')[0];if(E&&(E.checked=!t.user.payType),t.user.logoUrl){const l=document.getElementById("logoPreview");l&&(l.src=t.user.logoUrl,l.style.display="block",l.onerror=()=>{l.style.display="none"})}else if(t.user.logoBase64){const l=document.getElementById("logoPreview");l&&(l.src=t.user.logoBase64,l.style.display="block")}if(t.user.iconUrl){const l=document.getElementById("iconPreview");l&&(l.src=t.user.iconUrl,l.style.display="block",l.onerror=()=>{l.style.display="none"})}else if(t.user.iconBase64){const l=document.getElementById("iconPreview");l&&(l.src=t.user.iconBase64,l.style.display="block")}}}catch{window.showToast("매장 정보 로드에 실패했습니다.",3e3,"error")}}async function _(){var n;try{const o=JSON.parse(localStorage.getItem("userInfo")||"{}");if(!localStorage.getItem("accessToken"))return;const t=o.userId||"zero001",s=document.querySelector("#storeNm"),u=document.querySelector("#tel-input"),r=document.getElementById("businessNo"),m=document.querySelector("#remote-address"),d=document.querySelector('input[type="password"]'),f=document.querySelector('.in-box input[type="text"]'),y=document.querySelector("#wash-time-input"),l=document.querySelectorAll('input[type="checkbox"]')[0];let a=!1,N=!1,S=!1;if(s&&s.value!==(e==null?void 0:e.storeName)&&(a=!0),u&&u.value!==(e==null?void 0:e.tel)&&(a=!0),r&&r.value!==(e==null?void 0:e.businessNo)&&(a=!0),m&&m.value!==(e==null?void 0:e.remoteAddress)&&(a=!0),y&&y.value!==(e==null?void 0:e.washTime)&&(a=!0),l&&l.checked!==!(e!=null&&e.payType)&&(a=!0),d&&d.value!==""&&d.value!=="******"){if(d.value.length<6){window.showToast("비밀번호는 6자리 이상이어야 합니다.",3e3,"warning");return}N=!0}const I=(f==null?void 0:f.value)||"",b=((n=e==null?void 0:e.limitCount)==null?void 0:n.toString())||"";if(f&&I!==""&&I!==b&&(a=!0),(w||p||v||h)&&(S=!0),!a&&!N&&!S){window.showToast("변경사항이 없습니다.",3e3,"warning");return}if(a||S){const i={userId:t,adminId:t};s&&s.value!==(e==null?void 0:e.storeName)&&(i.storeName=s.value),u&&u.value!==(e==null?void 0:e.tel)&&(i.tel=u.value),r&&r.value!==(e==null?void 0:e.businessNo)&&(i.businessNo=r.value),m&&m.value!==(e==null?void 0:e.remoteAddress)&&(i.remoteAddress=m.value),y&&y.value!==(e==null?void 0:e.washTime)&&(i.washTime=y.value),l&&l.checked!==!(e!=null&&e.payType)&&(i.payType=!l.checked),f&&I!==""&&I!==b&&(i.limitCount=parseInt(I)),w?(i.logoFileName=w.name,i.logoBase64=g):v&&(i.logoFileName="",i.logoBase64="",i.logoUrl=""),p?(i.iconFileName=p.name,i.iconBase64=B):h&&(i.iconFileName="",i.iconBase64="",i.iconUrl="");const k=await C("/model_user_setting?func=update-user",i),T=await k.json();(T.success||T.status==="success"||k.ok)&&await L("/model_machine_controll",{userId:t,func:"update-user"})}if(N){const i={userId:t,newPassword:d.value,adminId:t};await C("/model_user_setting?func=update-password",i)}window.showToast("변경사항이 저장되었습니다.",3e3,"success"),d&&(d.value="******"),w&&(w=null,g=""),p&&(p=null,B=""),v=!1,h=!1,e&&(v&&(e.logoUrl="",e.logoBase64=""),h&&(e.iconUrl="",e.iconBase64=""))}catch{window.showToast("저장 중 오류가 발생했습니다.",3e3,"error")}}function R(){const n=document.getElementById("logoUpload");n&&n.addEventListener("change",O);const o=document.getElementById("iconUpload");o&&o.addEventListener("change",V);const c=document.querySelector(".icon-header button");c&&c.addEventListener("click",j);const s=document.querySelectorAll(".icon-header button")[1];s&&s.addEventListener("click",H)}function x(n,o,c){return new Promise(t=>{const s=new Image;s.onload=()=>{t(s.width<=o&&s.height<=c)},s.src=URL.createObjectURL(n)})}function P(n){return new Promise((o,c)=>{const t=new FileReader;t.onload=()=>{const u=t.result.split(",")[1];o(u)},t.onerror=c,t.readAsDataURL(n)})}function q(n){return new Promise((o,c)=>{const t=new FileReader;t.onload=()=>o(t.result),t.onerror=c,t.readAsDataURL(n)})}async function O(n){var u;const o=(u=n.target.files)==null?void 0:u[0];if(!o)return;if(o.size>2*1024*1024){window.showToast("파일 크기는 2MB 이하여야 합니다.",3e3,"warning");return}if(!await x(o,600,140)){window.showToast("로고 이미지는 600x140 이하여야 합니다.",3e3,"warning");return}w=o,g=await P(o),v=!1;const t=document.getElementById("fileName");t&&(t.textContent=o.name);const s=document.getElementById("logoPreview");if(s){const r=await q(o);s.src=r,s.style.display="block"}}async function V(n){var u;const o=(u=n.target.files)==null?void 0:u[0];if(!o)return;if(o.size>2*1024*1024){window.showToast("파일 크기는 2MB 이하여야 합니다.",3e3,"warning");return}if(!await x(o,1300,2e3)){window.showToast("아이콘 이미지는 1300x2000 이하여야 합니다.",3e3,"warning");return}p=o,B=await P(o),h=!1;const t=document.getElementById("iconFileName");t&&(t.textContent=o.name);const s=document.getElementById("iconPreview");if(s){const r=await q(o);s.src=r,s.style.display="block"}}function j(){if(!(e!=null&&e.logoUrl)&&!(e!=null&&e.logoBase64))return;w=null,g="",v=!0;const n=document.getElementById("logoUpload");n&&(n.value="");const o=document.getElementById("fileName");o&&(o.textContent="");const c=document.getElementById("logoPreview");c&&(c.src="",c.style.display="none"),e&&(e.logoUrl="",e.logoBase64="")}function H(){if(!(e!=null&&e.iconUrl)&&!(e!=null&&e.iconBase64))return;p=null,B="",h=!0;const n=document.getElementById("iconUpload");n&&(n.value="");const o=document.getElementById("iconFileName");o&&(o.textContent="");const c=document.getElementById("iconPreview");c&&(c.src="",c.style.display="none"),e&&(e.iconUrl="",e.iconBase64="")}export{G as initNormalSet};
