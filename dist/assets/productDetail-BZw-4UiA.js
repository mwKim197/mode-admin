import{r as W,v as G,a as J,h as z}from"./imageUploader-Dbb2WvuV.js";import{g as N,a as K,d as Q,e as X,f as Z}from"./main-CPfBtj8J.js";let y,w;async function ae(){const g=document.querySelector(".back-box");g&&(g.style.display="flex");const I=v("menuId");if(!I)return;const l=N();if(!l){window.showToast("사용자 정보가 없습니다.",3e3,"warning");return}const R=await(await K(`/model_admin_menu?userId=${l.userId}&menuId=${I}&func=get-menu-by-id`)).json();await W(R),document.getElementById("logoUpload").addEventListener("change",async n=>{await _(n)});const f=document.getElementById("saveDtlBtn");if(f){let n=function(){var d,u;const t=(d=document.querySelector('input[name="iceYn"]:checked'))==null?void 0:d.value,e=(u=document.querySelector('input[name="cupYn"]:checked'))==null?void 0:u.value,s=document.getElementById("ice-water-time-box");s&&(e==="yes"?s.style.display="none":s.style.display=t==="no"?"none":"block")},c=function(){var u;const e=((u=document.querySelector('input[name="cupYn"]:checked'))==null?void 0:u.value)==="yes",s=l==null?void 0:l.barcodeScanner;i&&(i.style.display=e?"none":"block"),a&&(a.style.display=e?"none":"block"),r&&(r.style.display=e?"none":"block");const d=document.getElementById("barcode-box");d&&(d.style.display=e&&s?"block":"none")};f.addEventListener("click",async()=>{const t=A(l.userId),e=G(t);if(e){window.showToast(e,3e3,"warning");return}const s=J(t);if(s){window.showToast(s,3e3,"warning");return}const d={...t,...y&&w&&{originalFileName:w,imageBase64:y}};if(confirm("수정사항을 저장하시겠습니까?")){const u={userId:l.userId,updatedData:d};try{if((await Q("/model_admin_menu?func=put-update-menu",u)).ok)window.showToast("수정사항 저장완료."),setTimeout(()=>{window.location.href="/html/product.html"},1e3);else{window.showToast("수정사항 저장에 실패하였습니다.",3e3,"error");return}}catch{}}}),n();const o=document.querySelectorAll('input[name="cupYn"]'),i=document.getElementById("items-container"),a=document.getElementById("cup-ice-selection-box"),r=document.getElementById("ice-water-time-box");o.forEach(t=>{t.addEventListener("change",c)}),c(),F()}function v(n){return new URLSearchParams(window.location.search).get(n)}async function _(n){const c=n.target,o=document.getElementById("logoPreview"),i=document.getElementById("fileName");if(!i){window.showToast("에러발생",3e3,"error");return}try{const{base64:a,fileName:r}=await z(c,o,i);y=a,w=r}catch(a){window.showToast(`이미지 업로드 실패: ${a}`,3e3,"warning"),console.warn("이미지 업로드 실패:",a)}}function F(){const n=document.getElementById("barcode-input"),c=document.getElementById("barcode-scan-btn");if(!n||!c){console.log("바코드 요소를 찾을 수 없습니다");return}c.addEventListener("click",async()=>{try{const o=N();if(!o){window.showToast("사용자 정보가 없습니다.",3e3,"error");return}if((await X("/model_machine_controll",{userId:o.userId,func:"barcode"})).ok){window.showToast("바코드를 스캔해주세요",2e3);const a=setInterval(async()=>{const r=await Z("/model_barcode_scan?func=barcode-claim-latest",{method:"POST",body:JSON.stringify({userId:o.userId})});if(r.ok){const t=await r.json();if(t.found&&t.code){clearInterval(a);const e=document.getElementById("barcode-input");e&&(e.value=t.code,e.setAttribute("data-field","barcode"))}}},1e3)}else window.showToast("바코드 스캔 시작에 실패했습니다.",3e3,"error")}catch(o){console.error("바코드 스캔 API 오류:",o),window.showToast("바코드 스캔 중 오류가 발생했습니다.",3e3,"error")}})}function A(n){var h,b,B,E,S;const c=Number(v("menuId")||"0"),o=Number(document.getElementById("menu-no").value),i=document.getElementById("menu-name").value,a=document.getElementById("menu-price").value.trim(),r=document.getElementById("menu-category").value,t=((h=document.querySelector('input[name="cupYn"]:checked'))==null?void 0:h.value)||"no",e=((b=document.querySelector('input[name="cup"]:checked'))==null?void 0:b.value)||"",s=((B=document.querySelector('input[name="iceYn"]:checked'))==null?void 0:B.value)||"",d=((E=document.querySelector('input[name="empty"]:checked'))==null?void 0:E.value)||"",u=document.getElementById("ice-time").value.trim(),p=document.getElementById("water-time").value.trim(),L=((S=document.getElementById("barcode-input"))==null?void 0:S.value.trim())||"",U="",V={best:document.getElementById("state-best").value,event:document.getElementById("state-event").value,new:document.getElementById("state-new").value},M=Array.from(document.querySelectorAll(".item")).map((k,$)=>{var q,x,P,Y,D;const T=((q=k.querySelector(".item-type-select"))==null?void 0:q.value)||"",m=k.querySelectorAll("input"),j=String(parseFloat(((x=m[0])==null?void 0:x.value)||"0")),C=String(parseFloat(((P=m[1])==null?void 0:P.value)||"0")),H=String(parseFloat(((Y=m[2])==null?void 0:Y.value)||"0")),O=T==="garucha"?"0":String(parseFloat(((D=m[3])==null?void 0:D.value)||"0"));return{no:String($+1),type:T,value1:j,value2:C,value3:H,value4:O}});return{userId:n,menuId:c,no:o,name:i,price:a,category:r,cupYn:t,cup:e,empty:d,iceYn:s,iceTime:u,waterTime:p,barcode:L,image:U,state:V,items:M}}}export{ae as initProductDetail};
