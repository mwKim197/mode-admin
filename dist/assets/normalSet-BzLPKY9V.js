import{a as P,d as b,e as N}from"./main-BIugHuUr.js";let w=null,p=null,g="",S="";function V(){A(),q(),L()}function q(){const r=document.querySelector(".btn-outline");r&&r.addEventListener("click",o=>{o.preventDefault(),F()})}let t=null;async function A(){try{const o=JSON.parse(localStorage.getItem("userInfo")||"{}").userId;if(!o)return;const e=await(await P(`/model_user_setting?func=get-user&userId=${o}`)).json();if(e&&e.user){t=e.user;const s=document.querySelector('input[name="player-id"]');s&&(s.value=e.user.storeName||"");const i=document.querySelector("#tel-input");i&&(i.value=e.user.tel||"");const l=document.querySelector('.in-box input[type="text"]');l&&(l.value=e.user.limitCount||"");const u=document.querySelector("#wash-time-input");u&&(u.value=e.user.washTime||"");const d=document.querySelector("#remote-address");d&&(d.value=e.user.remoteAddress||"");const h=document.querySelectorAll('input[type="checkbox"]')[0];if(h&&(h.checked=!e.user.payType),e.user.logoUrl){const n=document.getElementById("logoPreview");n&&(n.src=e.user.logoUrl,n.style.display="block",n.onerror=()=>{n.style.display="none"})}else if(e.user.logoBase64){const n=document.getElementById("logoPreview");n&&(n.src=e.user.logoBase64,n.style.display="block")}if(e.user.iconUrl){const n=document.getElementById("iconPreview");n&&(n.src=e.user.iconUrl,n.style.display="block",n.onerror=()=>{n.style.display="none"})}else if(e.user.iconBase64){const n=document.getElementById("iconPreview");n&&(n.src=e.user.iconBase64,n.style.display="block")}}}catch{window.showToast("매장 정보 로드에 실패했습니다.",3e3,"error")}}async function F(){var r;try{const o=JSON.parse(localStorage.getItem("userInfo")||"{}");if(!localStorage.getItem("authToken"))return;const e=o.userId||"zero001",s=document.querySelector('input[name="player-id"]'),i=document.querySelector("#tel-input"),l=document.querySelector("#remote-address"),u=document.querySelector('input[type="password"]'),d=document.querySelector('.in-box input[type="text"]'),f=document.querySelector("#wash-time-input"),n=document.querySelectorAll('input[type="checkbox"]')[0];let m=!1,v=!1,I=!1;if(s&&s.value!==(t==null?void 0:t.storeName)&&(m=!0),i&&i.value!==(t==null?void 0:t.tel)&&(m=!0),l&&l.value!==(t==null?void 0:t.remoteAddress)&&(m=!0),f&&f.value!==(t==null?void 0:t.washTime)&&(m=!0),n&&n.checked!==!(t!=null&&t.payType)&&(m=!0),u&&u.value!==""&&u.value!=="******"){if(u.value.length<6){window.showToast("비밀번호는 6자리 이상이어야 합니다.",3e3,"warning");return}v=!0}const y=(d==null?void 0:d.value)||"",B=((r=t==null?void 0:t.limitCount)==null?void 0:r.toString())||"";if(d&&y!==""&&y!==B&&(m=!0),(w||p)&&(I=!0),!m&&!v&&!I){window.showToast("변경사항이 없습니다.",3e3,"warning");return}if(m||I){const c={userId:e,adminId:e};s&&s.value!==(t==null?void 0:t.storeName)&&(c.storeName=s.value),i&&i.value!==(t==null?void 0:t.tel)&&(c.tel=i.value),l&&l.value!==(t==null?void 0:t.remoteAddress)&&(c.remoteAddress=l.value),f&&f.value!==(t==null?void 0:t.washTime)&&(c.washTime=f.value),n&&n.checked!==!(t!=null&&t.payType)&&(c.payType=!n.checked),d&&y!==""&&y!==B&&(c.limitCount=parseInt(y)),w&&(c.logoFileName=w.name,c.logoBase64=g),p&&(c.iconFileName=p.name,c.iconBase64=S);const k=await b("/model_user_setting?func=update-user",c),T=await k.json();(T.success||T.status==="success"||k.ok)&&await N("/model_machine_controll",{userId:e,func:"update-user"})}if(v){const c={userId:e,newPassword:u.value,adminId:e};await b("/model_user_setting?func=update-password",c)}window.showToast("변경사항이 저장되었습니다.",3e3,"success"),u&&(u.value="******"),w&&(w=null,g=""),p&&(p=null,S="")}catch{window.showToast("저장 중 오류가 발생했습니다.",3e3,"error")}}function L(){const r=document.getElementById("logoUpload");r&&r.addEventListener("change",z);const o=document.getElementById("iconUpload");o&&o.addEventListener("change",_)}function C(r,o,a){return new Promise(e=>{const s=new Image;s.onload=()=>{e(s.width<=o&&s.height<=a)},s.src=URL.createObjectURL(r)})}function x(r){return new Promise((o,a)=>{const e=new FileReader;e.onload=()=>{const i=e.result.split(",")[1];o(i)},e.onerror=a,e.readAsDataURL(r)})}function E(r){return new Promise((o,a)=>{const e=new FileReader;e.onload=()=>o(e.result),e.onerror=a,e.readAsDataURL(r)})}async function z(r){var i;const o=(i=r.target.files)==null?void 0:i[0];if(!o)return;if(o.size>2*1024*1024){window.showToast("파일 크기는 2MB 이하여야 합니다.",3e3,"warning");return}if(!await C(o,600,140)){window.showToast("로고 이미지는 600x140 이하여야 합니다.",3e3,"warning");return}w=o,g=await x(o);const e=document.getElementById("fileName");e&&(e.textContent=o.name);const s=document.getElementById("logoPreview");if(s){const l=await E(o);s.src=l,s.style.display="block"}}async function _(r){var i;const o=(i=r.target.files)==null?void 0:i[0];if(!o)return;if(o.size>2*1024*1024){window.showToast("파일 크기는 2MB 이하여야 합니다.",3e3,"warning");return}if(!await C(o,1300,2e3)){window.showToast("아이콘 이미지는 1300x2000 이하여야 합니다.",3e3,"warning");return}p=o,S=await x(o);const e=document.getElementById("iconFileName");e&&(e.textContent=o.name);const s=document.getElementById("iconPreview");if(s){const l=await E(o);s.src=l,s.style.display="block"}}export{V as initNormalSet};
