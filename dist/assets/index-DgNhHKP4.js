(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const o of t.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function s(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function n(e){if(e.ep)return;e.ep=!0;const t=s(e);fetch(e.href,t)}})();const d="https://api.narrowroad-model.com";async function u(r,a={}){const s=localStorage.getItem("authToken");if(!s)return window.location.pathname.includes("index.html")||window.location.pathname==="/"||(console.log("❌ 토큰이 없습니다. 로그인 페이지로 이동합니다."),window.location.href="/index.html"),null;const n={...a,headers:{...a.headers,Authorization:`Bearer ${s}`,"Content-Type":"application/json"}};try{const e=await fetch(`${d}/model_admin_login${r}`,n);if(e.status===401)return console.error("❌ 인증 실패: 토큰이 만료되었습니다."),localStorage.removeItem("authToken"),alert("세션이 만료되었습니다. 다시 로그인하세요."),window.location.href="/index.html",null;if(!e.ok)throw new Error(`❌ 요청 실패: ${e.statusText}`);return await e.json()}catch(e){return console.error("❌ API 요청 오류:",e),null}}async function m(){const r=await u("?func=me");r?console.log("✅ 사용자 정보:",r):console.log("❌ 사용자 정보를 가져오지 못했습니다.")}const c="https://api.narrowroad-model.com";document.addEventListener("DOMContentLoaded",()=>{console.log("✅ login.ts 파일이 정상적으로 로드되었습니다.");const r=document.getElementById("login-form");if(!r){console.error("❌ 로그인 폼을 찾을 수 없습니다.");return}r.addEventListener("submit",async a=>{a.preventDefault();const s=document.getElementById("userId").value.trim(),n=document.getElementById("password").value.trim();if(!s||!n){alert("아이디와 비밀번호를 입력해주세요.");return}try{const e=await fetch(`${c}/model_admin_login?func=login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:s,password:n}),mode:"cors"}),t=await e.json();e.ok?(localStorage.setItem("authToken",t.token),console.log("✅ 로그인 성공 → 토큰 저장 완료!"),window.location.href="/html/main.html"):alert(t.message||"로그인 실패. 다시 시도하세요.")}catch(e){console.error("❌ 로그인 오류:",e),alert("서버 오류가 발생했습니다. 다시 시도하세요.")}})});var i;(i=document.getElementById("kakao-login-btn"))==null||i.addEventListener("click",()=>{const n=window.open("https://kauth.kakao.com/oauth/authorize?response_type=code&client_id=240886095629b93f9655026145a39487&redirect_uri=http://model-web-admin.s3-website.ap-northeast-2.amazonaws.com/html/kakao-callback.html","kakaoLogin","width=500,height=700");window.addEventListener("message",e=>{if(e.origin!=="http://model-web-admin.s3-website.ap-northeast-2.amazonaws.com")return;const{code:t}=e.data;t&&(console.log("✅ 카카오 로그인 코드 받음:",t),n==null||n.close(),fetch(`${c}/model_admin_login?func=kakao-login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:t})}).then(o=>o.json().then(l=>({status:o.status,body:l}))).then(({body:o})=>{o.token?(localStorage.setItem("authToken",o.token),console.log("✅ 로그인 성공 → 토큰 저장 완료!"),window.location.href="/html/main.html"):o.redirectUrl?(console.log("✅ 신규 사용자 → 연동 페이지로 이동:",o.redirectUrl),window.location.href=o.redirectUrl):alert("카카오 로그인 실패. 다시 시도하세요.")}).catch(o=>{console.error("❌ 로그인 오류:",o)}))})});document.addEventListener("DOMContentLoaded",()=>{m()});
