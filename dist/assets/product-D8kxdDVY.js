import{g as I,a as B,e as C}from"./main-BhPhcrsp.js";const d=[];let m=[],y=null;function M(){const e=I();if(!e){window.showToast("❌ 사용자 정보가 없습니다.",3e3,"error");return}c();async function s(){return(await(await B(`/model_admin_menu?userId=${e==null?void 0:e.userId}&func=get-all-menu`)).json()).items}async function n(){try{const t=await s();m=t,w(t),d.length=0,setTimeout(()=>{var o;const r=sessionStorage.getItem("clickedProductNo");if(r){const i=document.querySelectorAll("tbody tr");for(let u of i){const g=u.querySelector("td:first-child");if(g&&((o=g.textContent)==null?void 0:o.trim())===r){u.scrollIntoView({behavior:"smooth",block:"center"});break}}sessionStorage.removeItem("clickedProductNo")}},200)}catch(t){console.error("❌ 메뉴 목록 불러오기 실패",t)}}function c(){const t=document.getElementById("searchProduct"),r=document.getElementById("searchButton"),o=document.getElementById("searchReset");r&&r.addEventListener("click",function(){const i=(t==null?void 0:t.value.trim())||"";k(i)}),o&&o.addEventListener("click",function(){t&&(t.value=""),w(m)}),t&&(t.addEventListener("keypress",function(i){if(i.key==="Enter"){const u=t.value.trim();k(u)}}),t.addEventListener("input",function(){const i=t.value.trim();y&&clearTimeout(y),y=setTimeout(()=>{l(i)},300)}))}function l(t){let r;t.length>0?r=m.filter(o=>{var i;return(i=o.name)==null?void 0:i.toLowerCase().includes(t.toLowerCase())}):r=m,w(r)}function k(t){let r;t.length>0?r=m.filter(o=>{var i;return(i=o.name)==null?void 0:i.toLowerCase().includes(t.toLowerCase())}):r=m,w(r),r.length===0&&t.length>0&&window.showToast(`"${t}"에 대한 검색 결과가 없습니다.`,3e3,"warning")}function w(t){const r=document.getElementById("menu-table-body");r&&(r.innerHTML=t.map((o,i)=>{var b;const u=((b=o.image)==null?void 0:b.split("\\").pop())??"",g=encodeURIComponent(u),P=`https://model-narrow-road.s3.ap-northeast-2.amazonaws.com/model/${o.userId}/${g}`;return`
      <tr>
        <td >${i+1}</td>
        <td style="text-align: center;"><img src="${P}" alt="상품 이미지" style="width:36px;height:46px; object-fit:cover;display: inline-block;"></td>
        <td class="product-name" onclick="
  sessionStorage.setItem('clickedProductNo', '${i+1}');
  window.location.href='./product-detail.html?menuId=${o.menuId}'
">
          ${o.name}
        </td>
        <td>${Number(o.price).toLocaleString()}</td>
        <td>
          <label class="toggle-switch">
            <input
              type="checkbox"
              ${o.empty==="no"?"checked":""}
              onchange="onToggleChange(${o.menuId}, this.checked)">
            <span class="slider"></span>
          </label>
        </td>
        <td>
          ${o.cupYn==="yes"?'<span class="tag gray disabled">제조</span>':`<span class="tag blue" data-menu='${encodeURIComponent(JSON.stringify(o))}' onclick="onAdminOder(this)">제조</span>`}
          <span class="tag red" onclick="onDeleteClick(${o.menuId}, event)">삭제</span>
        </td>
      </tr>
    `}).join(""))}n()}const T=document.getElementById("saveBtn");T&&T.addEventListener("click",()=>{if(d.length===0){window.showToast("변경된 내용이 없습니다.",3e3,"warning");return}confirm("수정사항을 저장하시겠습니까?")&&A().catch(()=>{window.showToast("❌ 수정에 실패했습니다.",3e3,"error")})});function D(e,s){O(e,{empty:s?"no":"yes"})}function S(e,s){s.stopPropagation();const n=s.target.closest("tr");if(!n)return;const c=d.findIndex(l=>l.menuId===e&&l.delete===!0);c!==-1?(d.splice(c,1),n.classList.remove("tr-disabled")):(d.push({menuId:e,delete:!0}),n.classList.add("tr-disabled"))}function x(e){return{orderData:{orderList:[{orderId:`${e.menuId}-${e.userId}`,userId:e.userId,menuId:e.menuId,name:e.name,count:1}]}}}function O(e,s){const n=d.findIndex(c=>c.menuId===e);n!==-1?d[n]={...d[n],...s}:d.push({menuId:e,...s})}async function A(){const e=I();if(!e)return;const s={userId:e.userId,items:d};try{const n=await C("/model_admin_menu?func=bulk-update-or-delete",s);if(n.ok)window.showToast("변경 사항 저장 완료"),location.reload();else{const c=await n.json();console.error("❌ 저장 실패:",c.message),window.showToast(`❌ 저장 실패: ${c.message} `,3e3,"error")}}catch(n){console.error("❌ 저장 오류:",n),window.showToast(`❌ 저장 오류: ${n} `,3e3,"error")}}async function f(e,s={}){const n=I();if(!n){window.showToast("❌ 사용자 정보가 없습니다.",3e3,"error");return}const c={func:e,userId:n.userId,...e==="order"?{orderData:s.orderData}:{},...e==="drink"?{orderData:{recipe:s}}:{},...e==="ice"?{orderData:{recipe:{iceTime:s.iceTime,waterTime:s.waterTime,name:s.name}}}:{}};C("/model_machine_controll",c).then(()=>{window.showToast(`${e} 명령 전송 완료`)}).catch(l=>{console.error(`❌ ${e} 명령 전송 실패:`,l),window.showToast(`❌ ${e} 명령 전송 실패: ${l} `,3e3,"error")}),window.showToast(`${e} 명령 전송`)}window.onToggleChange=D;window.onDeleteClick=S;window.onAdminOder=N;let a=null;function N(e){const s=decodeURIComponent(e.dataset.menu||"{}");a=JSON.parse(s);const c=document.getElementById("adminActionPopup");c&&(c.style.display="block")}function p(){const e=document.getElementById("adminActionPopup");e&&(e.style.display="none")}const $=document.getElementById("btnPopupTotalOrder");$&&$.addEventListener("click",()=>{if(a){if(!confirm("원격 명령을 전송하시겠습니까?"))return;const e=x(a);f("order",e),p()}});const E=document.getElementById("btnCupDispense");E&&E.addEventListener("click",()=>{if(a){const e=a.cup;e==="plastic"?confirm("원격 명령을 전송하시겠습니까?")&&(f("pl"),p()):e==="paper"&&confirm("원격 명령을 전송하시겠습니까?")&&(f("pa"),p())}});const L=document.getElementById("btnIceWaterDispense");L&&L.addEventListener("click",()=>{a&&confirm("원격 명령을 전송하시겠습니까?")&&(f("ice",a),p())});const v=document.getElementById("btnPopupDrinkOrder");v&&v.addEventListener("click",()=>{confirm("원격 명령을 전송하시겠습니까?")&&a&&(f("drink",a),p())});const h=document.getElementById("adminActionPopup");h&&h.addEventListener("click",e=>{e.target===h&&(h.style.display="none")});window.closeAdminPopup=p;export{M as initProduct};
