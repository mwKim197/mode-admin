import{a as f}from"./main-C2NTl3Dy.js";let d=[],i=[],a=1;const s=20;function B(){const e=sessionStorage.getItem("adminLogListState");e?y(JSON.parse(e)):m(),E()}function y(e){d=e.logs,i=e.filteredLogs,a=e.currentPage,document.getElementById("userIdInput").value=e.lastSearchUserId||"",document.getElementById("startDate").value=e.startDate||"",document.getElementById("endDate").value=e.endDate||"",document.getElementById("limitSelect").value=e.limit||"50",document.getElementById("filterKeyword").value=e.filterKeyword||"",c()}function m(){const e=document.getElementById("logList");e&&(e.innerHTML=`
        <p style="color:#888; padding: 10px;">조회된 로그가 없습니다.</p>
    `,g())}async function I(e,l,n,t){let o=`/model_admin_controll?func=list-admin-log&userId=${e}`;l&&n&&(o+=`&startDate=${l}&endDate=${n}`),t&&(o+=`&limit=${t}`),d=(await(await f(o)).json()).logs||[],i=[...d]}function E(){var e,l;(e=document.getElementById("userSearchBtn"))==null||e.addEventListener("click",async()=>{const n=document.getElementById("userIdInput").value.trim(),t=document.getElementById("startDate").value,o=document.getElementById("endDate").value,r=Number(document.getElementById("limitSelect").value);if(!n){window.showToast("조회할 계정을 입력하세요.",2e3,"warning");return}if(await I(n,t,o,r),d.length===0){m();return}a=1,c()}),(l=document.getElementById("filterBtn"))==null||l.addEventListener("click",()=>{const n=document.getElementById("filterKeyword"),t=n==null?void 0:n.value.trim().toLowerCase();t?i=d.filter(o=>JSON.stringify(o).toLowerCase().includes(t)):i=[...d],console.log(i),a=1,c()}),document.querySelectorAll(".pagination button").forEach(n=>{n.addEventListener("click",()=>{const t=n.getAttribute("data-page"),o=Math.ceil(i.length/s);t==="prev"&&a>1&&a--,t==="next"&&a<o&&a++,c()})})}function c(){const e=document.getElementById("logList");if(!e)return;if(i.length===0){m();return}const l=(a-1)*s,n=i.slice(l,l+s);e.innerHTML=n.map(t=>{var u;const o=((u=t.timestamp)==null?void 0:u.replace("T"," ").replace("+09:00",""))||"";return`
                <div class="log-row" data-log="${encodeURIComponent(JSON.stringify(t))}">
                    <div class="log-type">[${t.actionType}]</div>
                    <div class="log-date">${o}</div>
                </div>
            `}).join(""),e.querySelectorAll(".log-row").forEach(t=>{t.addEventListener("click",()=>{const o=t.getAttribute("data-log");if(!o)return;const r=JSON.parse(decodeURIComponent(o));v(r)})}),g()}function p(){const e={logs:d,filteredLogs:i,currentPage:a,lastSearchUserId:document.getElementById("userIdInput").value,startDate:document.getElementById("startDate").value,endDate:document.getElementById("endDate").value,limit:document.getElementById("limitSelect").value,filterKeyword:document.getElementById("filterKeyword").value};sessionStorage.setItem("adminLogListState",JSON.stringify(e))}function v(e){p(),console.log(e),localStorage.setItem("selectedLog",JSON.stringify(e)),window.location.href="/html/adminLogDetail.html"}function g(){const e=Math.ceil(i.length/s),l=document.getElementById("page-info");l&&(l.textContent=`${e===0?0:a} / ${e}`)}export{B as initAdmionLog};
