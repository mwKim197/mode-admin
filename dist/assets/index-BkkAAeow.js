(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const s of t.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function o(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function a(e){if(e.ep)return;e.ep=!0;const t=o(e);fetch(e.href,t)}})();const m="https://api.narrowroad-model.com";async function u(r,i={}){const o=localStorage.getItem("authToken");if(!o)return window.location.pathname.includes("index.html")||window.location.pathname==="/"||(console.log("❌ 토큰이 없습니다. 로그인 페이지로 이동합니다."),window.location.href="/index.html"),null;const a={...i,headers:{...i.headers,Authorization:`Bearer ${o}`,"Content-Type":"application/json"}};try{const e=await fetch(`${m}/model_admin_login${r}`,a);if(e.status===401)return console.error("❌ 인증 실패: 토큰이 만료되었습니다."),localStorage.removeItem("authToken"),alert("세션이 만료되었습니다. 다시 로그인하세요."),window.location.href="/index.html",null;if(!e.ok)throw new Error(`❌ 요청 실패: ${e.statusText}`);return await e.json()}catch(e){return console.error("❌ API 요청 오류:",e),null}}async function h(){const r=await u("?func=me");r?console.log("✅ 사용자 정보:",r):console.log("❌ 사용자 정보를 가져오지 못했습니다.")}const c="https://api.narrowroad-model.com";document.addEventListener("DOMContentLoaded",()=>{console.log("✅ login.ts 파일이 정상적으로 로드되었습니다.");const r=document.getElementById("login-form");if(!r){console.error("❌ 로그인 폼을 찾을 수 없습니다.");return}r.addEventListener("submit",async i=>{i.preventDefault();const o=document.getElementById("adminId").value.trim(),a=document.getElementById("password").value.trim();if(!o||!a){alert("아이디와 비밀번호를 입력해주세요.");return}try{const e=await fetch(`${c}/model_admin_login?func=login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({adminId:o,password:a}),mode:"cors"}),t=await e.json();e.ok?(localStorage.setItem("authToken",t.token),console.log("✅ 로그인 성공 → 토큰 저장 완료!"),window.location.href="/html/main.html"):alert(t.message||"로그인 실패. 다시 시도하세요.")}catch(e){console.error("❌ 로그인 오류:",e),alert("서버 오류가 발생했습니다. 다시 시도하세요.")}})});var l;(l=document.getElementById("kakao-login-btn"))==null||l.addEventListener("click",()=>{const o="https://kauth.kakao.com/oauth/authorize?response_type=code&client_id=240886095629b93f9655026145a39487&redirect_uri=http://model-web-admin.s3-website.ap-northeast-2.amazonaws.com/html/kakao-callback.html";if(window.innerWidth<=768||/Mobi|Android/i.test(navigator.userAgent))console.log("📱 모바일 환경 → 리디렉트 방식 사용"),window.location.href=o;else{console.log("💻 PC 환경 → 팝업 로그인 사용");const e=window.open(o,"kakaoLogin","width=500,height=700");window.addEventListener("message",t=>{if(t.origin!=="http://model-web-admin.s3-website.ap-northeast-2.amazonaws.com")return;const{code:s}=t.data;s&&(console.log("✅ 카카오 로그인 코드 받음:",s),e==null||e.close(),fetch(`${c}/model_admin_login?func=kakao-login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:s})}).then(n=>n.json().then(d=>({status:n.status,body:d}))).then(({body:n})=>{n.token?(localStorage.setItem("authToken",n.token),console.log("✅ 로그인 성공 → 토큰 저장 완료!"),window.location.href="/html/main.html"):n.redirectUrl?(console.log("✅ 신규 사용자 → 연동 페이지로 이동:",n.redirectUrl),window.location.href=n.redirectUrl):alert("카카오 로그인 실패. 다시 시도하세요.")}).catch(n=>{console.error("❌ 로그인 오류:",n)}))})}});document.addEventListener("DOMContentLoaded",()=>{h()});
