const r="https://api.narrowroad-model.com";function d(){console.log("✅ login.ts 로드됨");const l=document.getElementById("login-form");if(!l){console.error("❌ 로그인 폼을 찾을 수 없음");return}l.addEventListener("submit",async a=>{a.preventDefault(),localStorage.removeItem("authToken"),console.log("🗑️ 기존 로그인 토큰 삭제됨");const s=document.getElementById("adminId").value.trim(),t=document.getElementById("password").value.trim();if(!s||!t){alert("아이디와 비밀번호를 입력해주세요.");return}try{const e=await fetch(`${r}/model_admin_login?func=login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({adminId:s,password:t}),mode:"cors"}),n=await e.json();e.ok?(localStorage.setItem("authToken",n.token),console.log("✅ 로그인 성공 → 토큰 저장 완료!"),window.location.href="../../html/dashboard.html"):alert(n.message||"로그인 실패. 다시 시도하세요.")}catch(e){console.error("❌ 로그인 오류:",e),alert("서버 오류가 발생했습니다. 다시 시도하세요.")}});const i=document.getElementById("kakao-login-btn");i&&i.addEventListener("click",c)}function c(){const a="https://kauth.kakao.com/oauth/authorize?response_type=code&client_id=240886095629b93f9655026145a39487&redirect_uri=http://model-web-admin.s3-website.ap-northeast-2.amazonaws.com/html/kakao-callback.html";if(window.matchMedia("(max-width: 768px)").matches)console.log("📱 모바일 환경 → 리디렉트 방식"),window.location.href=a;else{console.log("💻 PC 환경 → 팝업 로그인 사용");const t=window.open(a,"kakaoLogin","width=500,height=700");window.addEventListener("message",e=>{if(e.origin!=="http://model-web-admin.s3-website.ap-northeast-2.amazonaws.com")return;const{code:n}=e.data;n&&(console.log("✅ 카카오 로그인 코드 받음:",n),t==null||t.close(),fetch(`${r}/model_admin_login?func=kakao-login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:n})}).then(o=>o.json()).then(o=>{o.token?(localStorage.removeItem("authToken"),console.log("🗑️ 기존 로그인 토큰 삭제됨"),localStorage.setItem("authToken",o.token),console.log("✅ 로그인 성공 → 토큰 저장 완료!"),window.location.href="../../html/dashboard.html"):o.redirectUrl?(console.log("✅ 신규 사용자 → 연동 페이지로 이동:",o.redirectUrl),window.location.href=o.redirectUrl):alert("카카오 로그인 실패. 다시 시도하세요.")}).catch(o=>{console.error("❌ 로그인 오류:",o)}))})}}export{d as initLogin};
