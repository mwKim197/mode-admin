import{a as P,d as T,e as q}from"./main-DOk1qqnK.js";let p=null,y=null,B="",S="";function j(){F(),A(),z()}function A(){const u=document.querySelector(".btn-outline");u&&u.addEventListener("click",o=>{o.preventDefault(),L()})}let t=null;async function F(){try{const o=JSON.parse(localStorage.getItem("userInfo")||"{}").userId;if(!o)return;const e=await(await P(`/model_user_setting?func=get-user&userId=${o}`)).json();if(e&&e.user){t=e.user;const s=document.getElementById("storeNm");s&&(s.value=e.user.storeName||"");const c=document.querySelector("#tel-input");c&&(c.value=e.user.tel||"");const r=document.getElementById("businessNo");r&&(r.value=e.user.businessNo||"");const m=document.querySelector('.in-box input[type="text"]');m&&(m.value=e.user.limitCount||"");const l=document.querySelector("#wash-time-input");l&&(l.value=e.user.washTime||"");const f=document.querySelector("#remote-address");f&&(f.value=e.user.remoteAddress||"");const v=document.querySelectorAll('input[type="checkbox"]')[0];if(v&&(v.checked=!e.user.payType),e.user.logoUrl){const n=document.getElementById("logoPreview");n&&(n.src=e.user.logoUrl,n.style.display="block",n.onerror=()=>{n.style.display="none"})}else if(e.user.logoBase64){const n=document.getElementById("logoPreview");n&&(n.src=e.user.logoBase64,n.style.display="block")}if(e.user.iconUrl){const n=document.getElementById("iconPreview");n&&(n.src=e.user.iconUrl,n.style.display="block",n.onerror=()=>{n.style.display="none"})}else if(e.user.iconBase64){const n=document.getElementById("iconPreview");n&&(n.src=e.user.iconBase64,n.style.display="block")}}}catch{window.showToast("매장 정보 로드에 실패했습니다.",3e3,"error")}}async function L(){var u;try{const o=JSON.parse(localStorage.getItem("userInfo")||"{}");if(!localStorage.getItem("accessToken"))return;const e=o.userId||"zero001",s=document.querySelector("#storeNm"),c=document.querySelector("#tel-input"),r=document.getElementById("businessNo"),m=document.querySelector("#remote-address"),l=document.querySelector('input[type="password"]'),f=document.querySelector('.in-box input[type="text"]'),w=document.querySelector("#wash-time-input"),n=document.querySelectorAll('input[type="checkbox"]')[0];let d=!1,I=!1,g=!1;if(s&&s.value!==(t==null?void 0:t.storeName)&&(d=!0),c&&c.value!==(t==null?void 0:t.tel)&&(d=!0),r&&r.value!==(t==null?void 0:t.businessNo)&&(d=!0),m&&m.value!==(t==null?void 0:t.remoteAddress)&&(d=!0),w&&w.value!==(t==null?void 0:t.washTime)&&(d=!0),n&&n.checked!==!(t!=null&&t.payType)&&(d=!0),l&&l.value!==""&&l.value!=="******"){if(l.value.length<6){window.showToast("비밀번호는 6자리 이상이어야 합니다.",3e3,"warning");return}I=!0}const h=(f==null?void 0:f.value)||"",b=((u=t==null?void 0:t.limitCount)==null?void 0:u.toString())||"";if(f&&h!==""&&h!==b&&(d=!0),(p||y)&&(g=!0),!d&&!I&&!g){window.showToast("변경사항이 없습니다.",3e3,"warning");return}if(d||g){const i={userId:e,adminId:e};s&&s.value!==(t==null?void 0:t.storeName)&&(i.storeName=s.value),c&&c.value!==(t==null?void 0:t.tel)&&(i.tel=c.value),r&&r.value!==(t==null?void 0:t.businessNo)&&(i.businessNo=r.value),m&&m.value!==(t==null?void 0:t.remoteAddress)&&(i.remoteAddress=m.value),w&&w.value!==(t==null?void 0:t.washTime)&&(i.washTime=w.value),n&&n.checked!==!(t!=null&&t.payType)&&(i.payType=!n.checked),f&&h!==""&&h!==b&&(i.limitCount=parseInt(h)),p&&(i.logoFileName=p.name,i.logoBase64=B),y&&(i.iconFileName=y.name,i.iconBase64=S);const N=await T("/model_user_setting?func=update-user",i),k=await N.json();(k.success||k.status==="success"||N.ok)&&await q("/model_machine_controll",{userId:e,func:"update-user"})}if(I){const i={userId:e,newPassword:l.value,adminId:e};await T("/model_user_setting?func=update-password",i)}window.showToast("변경사항이 저장되었습니다.",3e3,"success"),l&&(l.value="******"),p&&(p=null,B=""),y&&(y=null,S="")}catch{window.showToast("저장 중 오류가 발생했습니다.",3e3,"error")}}function z(){const u=document.getElementById("logoUpload");u&&u.addEventListener("change",_);const o=document.getElementById("iconUpload");o&&o.addEventListener("change",R)}function E(u,o,a){return new Promise(e=>{const s=new Image;s.onload=()=>{e(s.width<=o&&s.height<=a)},s.src=URL.createObjectURL(u)})}function C(u){return new Promise((o,a)=>{const e=new FileReader;e.onload=()=>{const c=e.result.split(",")[1];o(c)},e.onerror=a,e.readAsDataURL(u)})}function x(u){return new Promise((o,a)=>{const e=new FileReader;e.onload=()=>o(e.result),e.onerror=a,e.readAsDataURL(u)})}async function _(u){var c;const o=(c=u.target.files)==null?void 0:c[0];if(!o)return;if(o.size>2*1024*1024){window.showToast("파일 크기는 2MB 이하여야 합니다.",3e3,"warning");return}if(!await E(o,600,140)){window.showToast("로고 이미지는 600x140 이하여야 합니다.",3e3,"warning");return}p=o,B=await C(o);const e=document.getElementById("fileName");e&&(e.textContent=o.name);const s=document.getElementById("logoPreview");if(s){const r=await x(o);s.src=r,s.style.display="block"}}async function R(u){var c;const o=(c=u.target.files)==null?void 0:c[0];if(!o)return;if(o.size>2*1024*1024){window.showToast("파일 크기는 2MB 이하여야 합니다.",3e3,"warning");return}if(!await E(o,1300,2e3)){window.showToast("아이콘 이미지는 1300x2000 이하여야 합니다.",3e3,"warning");return}y=o,S=await C(o);const e=document.getElementById("iconFileName");e&&(e.textContent=o.name);const s=document.getElementById("iconPreview");if(s){const r=await x(o);s.src=r,s.style.display="block"}}export{j as initNormalSet};
